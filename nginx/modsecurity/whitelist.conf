# -----------------------------------------------------------------
# ModSecurity Whitelist Rules
# Purpose: Prevent False Positives on Critical API Endpoints
# -----------------------------------------------------------------

# 1. Allow Faro Monitoring (JSON payloads with stack traces often trigger SQLi/XSS rules)
SecRule REQUEST_URI "@beginsWith /api/v1/monitoring/ingest" \
    "id:1001,phase:1,pass,nolog,ctl:ruleEngine=Off"

# 2. Allow Post Management (Drafts, Edits, Publishing containing HTML)
# CHANGED: Broadened from '/api/v1/posts/admin' to '/api/v1/posts' to allow draft/edit endpoints
SecRule REQUEST_URI "@beginsWith /api/v1/posts" \
    "id:1002,phase:1,pass,nolog,ctl:ruleEngine=Off"

# 3. Allow Analytics Data Fetching
SecRule REQUEST_URI "@beginsWith /api/v1/analytics" \
    "id:1003,phase:1,pass,nolog,ctl:ruleEngine=Off"

# 4. Allow Status History
SecRule REQUEST_URI "@beginsWith /api/v1/status" \
    "id:1004,phase:1,pass,nolog,ctl:ruleEngine=Off"