"use strict";(self.webpackChunktreishvaam_finance_frontend=self.webpackChunktreishvaam_finance_frontend||[]).push([[966],{4472:(e,s,t)=>{t.d(s,{A:()=>u});var a=t(9379),n=t(5043),r=t(6355),l=t(184);const i=e=>{if(e<0)return{hours:0,minutes:0,seconds:0,isFinished:!0};return{hours:Math.floor(e%864e5/36e5),minutes:Math.floor(e%36e5/6e4),seconds:Math.floor(e%6e4/1e3),isFinished:!1}};var o=t(579);const c=e=>{let{log:s}=e;const t="SUCCESS"===s.status;return(0,o.jsxs)("div",{className:"text-xs border-l-4 pl-3",style:{borderColor:t?"#10B981":"#EF4444"},children:[(0,o.jsxs)("div",{className:"flex items-center font-semibold",style:{color:t?"#059669":"#DC2626"},children:[t?(0,o.jsx)(l.A7C,{className:"mr-2"}):(0,o.jsx)(l.TNq,{className:"mr-2"}),s.status," - ",(0,o.jsx)("span",{className:"font-normal text-gray-500 ml-1",children:(a=s.lastFetchTime,new Date(a).toLocaleString())})]}),(0,o.jsxs)("p",{className:"text-gray-600 mt-1",children:["Source: ",(0,o.jsx)("span",{className:"font-medium",children:s.triggerSource}),". Details: ",s.details]})]});var a},d=e=>{let{title:s,logs:t,onRefresh:a,onFlush:r,nextRefreshTime:d}=e;const[m,h]=(0,n.useState)(!1),[u,x]=(0,n.useState)(!1),[f,g]=(0,n.useState)(!1),{hours:p,minutes:b,seconds:y,isFinished:j}=(e=>{const s=(0,n.useMemo)(()=>new Date(e).getTime(),[e]),[t,a]=(0,n.useState)(s-(new Date).getTime());return(0,n.useEffect)(()=>{const e=setInterval(()=>{a(s-(new Date).getTime())},1e3);return()=>clearInterval(e)},[s]),i(t)})(d),C=async(e,s)=>{x(!0);try{await s(e)}catch(t){console.error("Flush failed:",t)}x(!1)},v=e=>e.toString().padStart(2,"0"),N=j?"Refresh due":"".concat(v(p),"h ").concat(v(b),"m ").concat(v(y),"s"),w=f?t:t.slice(0,3);return(0,o.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-md border border-gray-200",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,o.jsx)("h3",{className:"text-lg font-bold text-gray-800",children:s}),(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,o.jsx)("button",{onClick:async()=>{h(!0),await a(),h(!1)},disabled:m,className:"p-2 text-sm text-sky-600 bg-sky-100 hover:bg-sky-200 rounded-full transition disabled:opacity-50 disabled:cursor-wait",title:"Refresh Data Now",children:(0,o.jsx)(l.DIg,{className:m?"animate-spin":""})}),(0,o.jsx)("button",{onClick:()=>r(C),disabled:u,className:"p-2 text-sm text-red-600 bg-red-100 hover:bg-red-200 rounded-full transition disabled:opacity-50",title:"Flush Cached Data",children:(0,o.jsx)(l.qbC,{})})]})]}),d&&(0,o.jsxs)("p",{className:"text-xs text-gray-500 mb-4",children:["Auto-refresh in: ",(0,o.jsx)("span",{className:"font-semibold text-gray-600",children:N})]}),(0,o.jsx)("div",{className:"space-y-3",children:w.length>0?w.map(e=>(0,o.jsx)(c,{log:e},e.id)):(0,o.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No logs available."})}),t.length>3&&(0,o.jsxs)("button",{onClick:()=>g(!f),className:"text-sm text-sky-600 font-semibold mt-4 flex items-center",children:[f?"Show Recent Logs":"Show All Logs",f?(0,o.jsx)(l.Ucs,{className:"ml-2"}):(0,o.jsx)(l.Vr3,{className:"ml-2"})]})]})},m=e=>{let{isOpen:s,onClose:t,onConfirm:a,title:r,isLoading:l}=e;const[i,c]=(0,n.useState)("");if(!s)return null;return(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 flex justify-center items-center",children:(0,o.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md",children:[(0,o.jsx)("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:r}),(0,o.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"This is a destructive action. To confirm, please enter your admin password."}),(0,o.jsx)("input",{type:"password",value:i,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500",placeholder:"Enter your password",autoFocus:!0}),(0,o.jsxs)("div",{className:"flex justify-end mt-6 space-x-3",children:[(0,o.jsx)("button",{onClick:()=>{c(""),t()},disabled:l,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition",children:"Cancel"}),(0,o.jsx)("button",{onClick:()=>{a(i),c("")},disabled:!i||l,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition disabled:opacity-50 disabled:cursor-wait",children:l?"Flushing...":"Confirm & Flush"})]})]})})};function h(e,s,t){const a=new Date;let n=new Date;return n.setUTCHours(e,s,0,0),a.getTime()>n.getTime()&&n.setUTCDate(n.getUTCDate()+1),n}const u=()=>{const[e,s]=(0,n.useState)([]),[t,l]=(0,n.useState)(!0),[i,c]=(0,n.useState)({isOpen:!1,onConfirm:null,title:""}),[u,x]=(0,n.useState)(!1),f=(0,n.useCallback)(async()=>{l(!0);try{const e=await(0,r.r$)();s(e.data)}catch(e){console.error("Failed to fetch API status history:",e)}finally{l(!1)}},[]);(0,n.useEffect)(()=>{f()},[f]);const g=[{title:"US Market Indices (Charts)",logFilters:["Market Chart"],onRefresh:r.FE,flushHandler:r.av,nextRefreshTime:null},{title:"Top Gainers (US)",logFilters:["Market Data - Top Gainers (US)"],onRefresh:r.Cn,flushHandler:r.fk,nextRefreshTime:h(22,0,"UTC")},{title:"Top Losers (US)",logFilters:["Market Data - Top Losers (US)"],onRefresh:r.Cn,flushHandler:r.fk,nextRefreshTime:h(22,0,"UTC")},{title:"Most Active (US)",logFilters:["Market Data - Most Active (US)"],onRefresh:r.Cn,flushHandler:r.fk,nextRefreshTime:h(22,0,"UTC")}];return(0,o.jsxs)("div",{className:"bg-gray-50 p-4 sm:p-6 lg:p-8",children:[(0,o.jsx)("h2",{className:"text-2xl font-bold mb-6 text-gray-800",children:"API Status & Control Center"}),t?(0,o.jsx)("p",{children:"Loading logs..."}):(0,o.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:g.map(s=>{return(0,o.jsx)(d,{title:s.title,logs:(t=s.logFilters,e.filter(e=>t.some(s=>e.apiName.includes(s)))),onRefresh:s.onRefresh,onFlush:e=>{return t=t=>e(t,s.flushHandler),a="Flush ".concat(s.title),void c({isOpen:!0,onConfirm:e=>t(e),title:a});var t,a},nextRefreshTime:s.nextRefreshTime},s.title);var t})}),(0,o.jsx)(m,{isOpen:i.isOpen,onClose:()=>c((0,a.A)((0,a.A)({},i),{},{isOpen:!1})),onConfirm:async e=>{if(i.onConfirm){x(!0);try{await i.onConfirm(e)}catch(a){var s,t;console.error("Action failed:",a),alert("Action failed: ".concat((null===(s=a.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.message)||a.message))}finally{x(!1),c({isOpen:!1,onConfirm:null,title:""}),await f()}}},title:i.title,isLoading:u})]})}},7966:(e,s,t)=>{t.r(s),t.d(s,{default:()=>r});t(5043);var a=t(4472),n=t(579);const r=()=>(0,n.jsx)("div",{className:"container mx-auto p-6 md:p-8",children:(0,n.jsx)(a.A,{showHistory:!0})})}}]);
//# sourceMappingURL=966.9330e932.chunk.js.map