"use strict";(self.webpackChunktreishvaam_finance_frontend=self.webpackChunktreishvaam_finance_frontend||[]).push([[106],{1106:(e,t,s)=>{s.r(t),s.d(t,{default:()=>c});var a=s(5043),l=s(6355),r=s(184),i=s(579);const n=e=>{let{icon:t,value:s,label:a}=e;return(0,i.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[(0,i.jsx)(t,{className:"text-sky-500 mr-2 flex-shrink-0",title:a}),(0,i.jsx)("span",{className:"truncate",title:s||"N/A",children:s||"N/A"})]})},d=()=>(new Date).toISOString().split("T")[0],c=()=>{const[e,t]=(0,a.useState)([]),[s,c]=(0,a.useState)(!1),[o,x]=(0,a.useState)(""),[m,h]=(0,a.useState)(d()),[u,g]=(0,a.useState)(d()),[p,y]=(0,a.useState)(""),[f,j]=(0,a.useState)(""),[N,b]=(0,a.useState)(""),[v,w]=(0,a.useState)(null),k=async(e,s,a,r,i)=>{if(c(!0),x(""),!e||!s||new Date(e)>new Date(s))return x("Invalid date range. Start date must be before or equal to the end date."),void c(!1);try{const n=await(0,l.vv)(e,s,a,r,i);t(n.data),w(new Date)}catch(n){console.error("Error fetching audience data:",n),!n.response||403!==n.response.status&&401!==n.response.status?x("Failed to fetch historical audience data. Check backend logs and GA4 setup. The last attempt to fetch historical data might have failed."):x("Access Denied. You do not have permission to view this data."),t([])}finally{c(!1)}};(0,a.useEffect)(()=>{const e=new Date,t=new Date(e.getTime()-6048e5).toISOString().split("T")[0];h(t),k(t,d(),p,f,N)},[]);const S=(e,t)=>{const s=e.target.value;"start"===t?h(s):g(s)},D=()=>{k(m,u,p,f,N)},F=[{key:"sessionDate",title:"Date",render:e=>(0,i.jsx)(n,{icon:r.bfZ,value:e.sessionDate,label:"Session Date"})},{key:"location",title:"Location (City, Region, Country)",render:e=>(0,i.jsx)(n,{icon:r.ZYm,value:"".concat(e.city||"N/A",", ").concat(e.region||"N/A",", ").concat(e.country||"N/A"),label:"Location"})},{key:"device",title:"Device & OS",render:e=>(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("p",{className:"text-xs text-gray-700 font-semibold",children:[(0,i.jsx)(r.rle,{className:"inline mr-1 text-sky-500"})," ",e.deviceCategory," (",e.deviceModel||"N/A",")"]}),(0,i.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,i.jsx)(r.f35,{className:"inline mr-1 text-sky-500"})," ",e.operatingSystem," (",e.osVersion||"N/A",")"]}),(0,i.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,i.jsx)(r.Wqt,{className:"inline mr-1 text-sky-500"})," Resolution: ",e.screenResolution||"N/A"]})]})},{key:"traffic",title:"Source & Landing Page",render:e=>(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("p",{className:"text-xs text-gray-700 font-semibold",children:["Source: ",e.sessionSource]}),(0,i.jsxs)("p",{className:"text-xs text-gray-500 truncate max-w-xs",title:e.landingPage,children:["Landing: ",e.landingPage]})]})},{key:"time",title:"Time & Views",render:e=>(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("p",{className:"text-xs text-gray-700 font-semibold",children:[(0,i.jsx)(r.w_X,{className:"inline mr-1 text-sky-500"})," ",e.timeOnSiteFormatted]}),(0,i.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,i.jsx)(r.v$b,{className:"inline mr-1 text-sky-500"})," Sessions: ",e.views]}),(0,i.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,i.jsx)(r.x$1,{className:"inline mr-1 text-sky-500"})," ID: ",e.userIdentifier?e.userIdentifier.substring(0,8)+"...":"N/A"]})]})}];return(0,i.jsxs)("div",{className:"container mx-auto p-6 md:p-8",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:"Historical Audience Report"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:"Detailed visitor logs stored in the database. Data is synchronized daily from Google Analytics (GA4)."}),(0,i.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-4 flex flex-wrap items-center justify-between space-y-2 md:space-y-0 md:space-x-4",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2 w-full md:w-auto",children:[(0,i.jsx)("label",{htmlFor:"startDate",className:"text-sm font-medium text-gray-700 flex-shrink-0",children:"From:"}),(0,i.jsx)("input",{type:"date",id:"startDate",value:m,onChange:e=>S(e,"start"),className:"p-2 border border-gray-300 rounded-lg w-full text-sm",disabled:s})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2 w-full md:w-auto",children:[(0,i.jsx)("label",{htmlFor:"endDate",className:"text-sm font-medium text-gray-700 flex-shrink-0",children:"To:"}),(0,i.jsx)("input",{type:"date",id:"endDate",value:u,onChange:e=>S(e,"end"),className:"p-2 border border-gray-300 rounded-lg w-full text-sm",disabled:s})]}),(0,i.jsx)("div",{className:"w-full md:w-auto mt-2 md:mt-0",children:(0,i.jsxs)("button",{onClick:D,disabled:s,className:"flex items-center px-4 py-2 text-sm rounded-lg transition duration-300 w-full justify-center ".concat(s?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-sky-600 text-white hover:bg-sky-700"),children:[(0,i.jsx)(r.KSO,{className:"mr-2 ".concat(s?"animate-pulse":"")}),s?"Fetching...":"Apply Date Filter"]})})]}),(0,i.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2 w-full",children:[(0,i.jsx)("label",{htmlFor:"countryFilter",className:"text-sm font-medium text-gray-700 flex-shrink-0",children:"Country:"}),(0,i.jsx)("input",{type:"text",id:"countryFilter",placeholder:"e.g. United States (Full Match)",value:p,onChange:e=>y(e.target.value),className:"p-2 border border-gray-300 rounded-lg w-full text-sm",disabled:s})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2 w-full",children:[(0,i.jsx)("label",{htmlFor:"regionFilter",className:"text-sm font-medium text-gray-700 flex-shrink-0",children:"Region:"}),(0,i.jsx)("input",{type:"text",id:"regionFilter",placeholder:"e.g. California (Full Match)",value:f,onChange:e=>j(e.target.value),className:"p-2 border border-gray-300 rounded-lg w-full text-sm",disabled:s})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2 w-full",children:[(0,i.jsx)("label",{htmlFor:"deviceCategoryFilter",className:"text-sm font-medium text-gray-700 flex-shrink-0",children:"Device:"}),(0,i.jsx)("input",{type:"text",id:"deviceCategoryFilter",placeholder:"e.g. desktop (Full Match)",value:N,onChange:e=>b(e.target.value),className:"p-2 border border-gray-300 rounded-lg w-full text-sm",disabled:s})]}),(0,i.jsx)("div",{className:"md:col-span-3",children:(0,i.jsxs)("button",{onClick:D,disabled:s,className:"flex items-center px-4 py-2 text-sm rounded-lg transition duration-300 w-full justify-center ".concat(s?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"),children:[(0,i.jsx)(r.KSO,{className:"mr-2"})," Apply Multi-Level Filters"]})})]}),(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-x-auto",children:[o&&(0,i.jsxs)("div",{className:"p-4 bg-red-100 text-red-700 border-l-4 border-red-500 flex items-center",children:[(0,i.jsx)(r.BS8,{className:"mr-3 flex-shrink-0 text-xl"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-semibold",children:o}),(0,i.jsx)("p",{className:"text-sm",children:"Please check the date range and ensure the scheduled job is running successfully to import new data."})]})]}),s&&0===e.length?(0,i.jsxs)("div",{className:"p-6 text-center text-gray-500",children:[(0,i.jsx)(r.Swo,{className:"mx-auto text-3xl mb-2 animate-spin"}),(0,i.jsx)("p",{children:"Loading historical report for selected dates..."})]}):(0,i.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,i.jsx)("thead",{className:"bg-gray-50",children:(0,i.jsx)("tr",{children:F.map(e=>(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:e.title},e.key))})}),(0,i.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.length>0?e.map((e,t)=>(0,i.jsx)("tr",{className:"hover:bg-sky-50/50",children:F.map(t=>(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:t.render(e)},t.key))},e.id||t)):!o&&(0,i.jsx)("tr",{children:(0,i.jsxs)("td",{colSpan:F.length,className:"px-6 py-12 text-center text-gray-500",children:[(0,i.jsx)(r.v$b,{className:"mx-auto text-4xl mb-4 text-gray-400"}),(0,i.jsx)("p",{className:"text-lg font-semibold",children:"No visitor data found for the selected date range."}),(0,i.jsx)("p",{className:"text-sm",children:"If this is the first day after implementation, initial data might be pending synchronization. Check back tomorrow."})]})})})]})]})]})}}}]);
//# sourceMappingURL=106.a36c82c3.chunk.js.map