{"version":3,"file":"static/js/106.8fd4f59b.chunk.js","mappings":"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","sources":["pages/AudiencePage.js"],"sourcesContent":["import React, { useEffect, useState, useCallback } from 'react';\r\nimport { getHistoricalAudienceData, getFilterOptions } from '../apiConfig';\r\nimport {\r\n    FaCalendarAlt, FaMapMarkedAlt, FaMobileAlt, FaDesktop, FaClock, FaRedo,\r\n    FaExclamationTriangle, FaChartBar, FaUser, FaGlobe, FaSearch, FaPlus, FaTimes\r\n} from 'react-icons/fa';\r\n\r\n// Helper component for table cell display\r\nconst DetailCell = ({ icon: Icon, value, label }) => (\r\n    <div className=\"flex items-center text-sm text-gray-700\">\r\n        <Icon className=\"text-sky-500 mr-2 flex-shrink-0\" title={label} />\r\n        <span className=\"truncate\" title={value || 'N/A'}>\r\n            {value || 'N/A'}\r\n        </span>\r\n    </div>\r\n);\r\n\r\n// Function to format today's date in YYYY-MM-DD format\r\nconst getTodayDateString = () => {\r\n    return new Date().toISOString().split('T')[0];\r\n};\r\n\r\n// Define the available filter types and their user-friendly labels\r\nconst FILTER_TYPES = {\r\n    country: 'Country',\r\n    region: 'Region',\r\n    city: 'City', // Added back\r\n    // 'deviceCategory' removed\r\n    operatingSystem: 'Operating System',\r\n    osVersion: 'OS Version',\r\n    sessionSource: 'Session Source',\r\n};\r\n\r\n// Define dependencies for cascading resets\r\nconst FILTER_DEPENDENCIES = {\r\n    country: ['region', 'city'],\r\n    region: ['city'],\r\n    operatingSystem: ['osVersion'],\r\n};\r\n\r\nconst AudiencePage = () => {\r\n    const [data, setData] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [optionsLoading, setOptionsLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n\r\n    // --- NEW FILTER STATE ---\r\n    const [startDate, setStartDate] = useState(\r\n        new Date(new Date().getTime() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]\r\n    );\r\n    const [endDate, setEndDate] = useState(getTodayDateString());\r\n    // Holds the dynamic filter rows, e.g., [{ id: 1, type: 'country', value: 'India' }]\r\n    const [filters, setFilters] = useState([]);\r\n    // Holds the dynamic options for all dropdowns, e.g., { countries: ['India', 'USA'], regions: ['Rajasthan'] }\r\n    const [filterOptions, setFilterOptions] = useState(null);\r\n    // --- END NEW FILTER STATE ---\r\n\r\n    // Helper to convert the filters array into a flat params object for the API\r\n    const buildApiParams = useCallback(() => {\r\n        const params = {\r\n            startDate,\r\n            endDate,\r\n        };\r\n        filters.forEach(filter => {\r\n            if (filter.type && filter.value) {\r\n                params[filter.type] = filter.value;\r\n            }\r\n        });\r\n        return params;\r\n    }, [startDate, endDate, filters]);\r\n\r\n\r\n    // Main data fetching logic, triggered by any filter change\r\n    useEffect(() => {\r\n        const fetchDataAndOptions = async () => {\r\n            setLoading(true);\r\n            setOptionsLoading(true);\r\n            setError('');\r\n\r\n            const params = buildApiParams();\r\n\r\n            // We fetch both data and options simultaneously\r\n            try {\r\n                const [optionsResponse, dataResponse] = await Promise.all([\r\n                    getFilterOptions(params),\r\n                    getHistoricalAudienceData(params)\r\n                ]);\r\n\r\n                setFilterOptions(optionsResponse.data);\r\n                setData(dataResponse.data);\r\n\r\n            } catch (err) {\r\n                console.error('Error fetching audience data or options:', err);\r\n                if (err.response && (err.response.status === 403 || err.response.status === 401)) {\r\n                    setError('Access Denied. You do not have permission to view this data.');\r\n                } else {\r\n                    setError('Failed to fetch historical audience data. Check backend logs and GA4 setup.');\r\n                }\r\n                setData([]);\r\n                setFilterOptions(null); // Reset options on error\r\n            } finally {\r\n                setLoading(false);\r\n                setOptionsLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchDataAndOptions();\r\n    }, [startDate, endDate, filters, buildApiParams]); // Reacts to any change\r\n\r\n\r\n    // --- FILTER ROW MANAGEMENT ---\r\n\r\n    const addFilter = () => {\r\n        setFilters(prevFilters => [\r\n            ...prevFilters,\r\n            { id: Date.now(), type: '', value: '' } // Use timestamp as unique key\r\n        ]);\r\n    };\r\n\r\n    const removeFilter = (id) => {\r\n        setFilters(prevFilters => prevFilters.filter(f => f.id !== id));\r\n    };\r\n\r\n    const updateFilter = (id, field, newValue) => {\r\n        setFilters(prevFilters => {\r\n            const newFilters = [...prevFilters];\r\n            const filterIndex = newFilters.findIndex(f => f.id === id);\r\n            if (filterIndex === -1) return prevFilters;\r\n\r\n            const oldFilter = newFilters[filterIndex];\r\n            newFilters[filterIndex] = { ...oldFilter, [field]: newValue };\r\n\r\n            // --- CASCADING RESET LOGIC ---\r\n            if (field === 'type') {\r\n                // If user changes the *type* of filter, reset its value\r\n                newFilters[filterIndex].value = '';\r\n            }\r\n\r\n            // If user changes a value, reset dependent filters\r\n            // e.g., If 'country' changes, reset 'region' and 'city'\r\n            const dependencies = FILTER_DEPENDENCIES[oldFilter.type];\r\n            if (field === 'value' && dependencies) {\r\n                return newFilters.map(f => {\r\n                    if (dependencies.includes(f.type)) {\r\n                        return { ...f, value: '' }; // Reset value of dependent filter\r\n                    }\r\n                    return f;\r\n                });\r\n            }\r\n            // --- END CASCADING LOGIC ---\r\n\r\n            return newFilters;\r\n        });\r\n    };\r\n\r\n    // --- END FILTER ROW MANAGEMENT ---\r\n\r\n\r\n    const columns = [\r\n        {\r\n            key: 'sessionDate',\r\n            title: 'Date',\r\n            render: (item) => <DetailCell icon={FaCalendarAlt} value={item.sessionDate} label=\"Session Date\" />\r\n        },\r\n        {\r\n            key: 'location',\r\n            title: 'Location (City, Region, Country)',\r\n            render: (item) => (\r\n                <DetailCell\r\n                    icon={FaMapMarkedAlt}\r\n                    value={`${item.city || 'N/A'}, ${item.region || 'N/A'}, ${item.country || 'N/A'}`}\r\n                    label=\"Location\"\r\n                />\r\n            )\r\n        },\r\n        {\r\n            key: 'device',\r\n            title: 'Device & OS',\r\n            render: (item) => (\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-700 font-semibold\">\r\n                        <FaMobileAlt className=\"inline mr-1 text-sky-500\" /> {item.deviceCategory} ({item.deviceModel || 'N/A'})\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        <FaGlobe className=\"inline mr-1 text-sky-500\" /> {item.operatingSystem} ({item.osVersion || 'N/A'})\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        <FaDesktop className=\"inline mr-1 text-sky-500\" /> Resolution: {item.screenResolution || 'N/A'}\r\n                    </p>\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            key: 'traffic',\r\n            title: 'Source & Landing Page',\r\n            render: (item) => (\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-700 font-semibold\">Source: {item.sessionSource}</p>\r\n                    <p className=\"text-xs text-gray-500 truncate max-w-xs\" title={item.landingPage}>Landing: {item.landingPage}</p>\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            key: 'time',\r\n            title: 'Time & Views',\r\n            render: (item) => (\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-700 font-semibold\">\r\n                        <FaClock className=\"inline mr-1 text-sky-500\" /> {item.timeOnSiteFormatted}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        <FaChartBar className=\"inline mr-1 text-sky-500\" /> Sessions: {item.views}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        <FaUser className=\"inline mr-1 text-sky-500\" /> ID: {item.userIdentifier ? item.userIdentifier.substring(0, 8) + '...' : 'N/A'}\r\n                    </p>\r\n                </div>\r\n            )\r\n        }\r\n    ];\r\n\r\n    // Helper to get the correct options list for a given filter type\r\n    const getOptionsForFilterType = (type) => {\r\n        if (!filterOptions) return [];\r\n        switch (type) {\r\n            case 'country': return filterOptions.countries || [];\r\n            case 'region': return filterOptions.regions || [];\r\n            case 'city': return filterOptions.cities || []; // Added back\r\n            // 'deviceCategory' removed\r\n            case 'operatingSystem': return filterOptions.operatingSystems || [];\r\n            case 'osVersion': return filterOptions.osVersions || [];\r\n            case 'sessionSource': return filterOptions.sessionSources || [];\r\n            default: return [];\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"container mx-auto p-6 md:p-8\">\r\n            <h1 className=\"text-3xl font-bold text-gray-800 mb-4\">Historical Audience Report</h1>\r\n            <p className=\"text-gray-600 mb-6\">Detailed visitor logs stored in the database. Data is synchronized daily from Google Analytics (GA4).</p>\r\n\r\n            {/* --- DATE FILTER ROW --- */}\r\n            <div className=\"bg-white p-4 rounded-lg shadow-sm mb-4 flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4\">\r\n                <div className=\"flex items-center space-x-2 w-full md:w-auto\">\r\n                    <label htmlFor=\"startDate\" className=\"text-sm font-medium text-gray-700 flex-shrink-0\">From:</label>\r\n                    <input\r\n                        type=\"date\"\r\n                        id=\"startDate\"\r\n                        value={startDate}\r\n                        onChange={(e) => setStartDate(e.target.value)}\r\n                        className=\"p-2 border border-gray-300 rounded-lg w-full text-sm\"\r\n                        disabled={loading || optionsLoading}\r\n                    />\r\n                </div>\r\n                <div className=\"flex items-center space-x-2 w-full md:w-auto\">\r\n                    <label htmlFor=\"endDate\" className=\"text-sm font-medium text-gray-700 flex-shrink-0\">To:</label>\r\n                    <input\r\n                        type=\"date\"\r\n                        id=\"endDate\"\r\n                        value={endDate}\r\n                        onChange={(e) => setEndDate(e.target.value)}\r\n                        className=\"p-2 border border-gray-300 rounded-lg w-full text-sm\"\r\n                        disabled={loading || optionsLoading}\r\n                    />\r\n                </div>\r\n                <div className=\"text-sm text-gray-500 flex-grow\">\r\n                    {(loading || optionsLoading) && <FaRedo className=\"inline mr-2 animate-spin\" />}\r\n                    {loading ? 'Fetching report data...' : ''}\r\n                    {optionsLoading && !loading ? 'Updating filter options...' : ''}\r\n                </div>\r\n            </div>\r\n\r\n            {/* --- DYNAMIC MULTI-LEVEL FILTER ROW --- */}\r\n            <div className=\"bg-white p-4 rounded-lg shadow-sm mb-6 space-y-3\">\r\n                <label className=\"text-sm font-medium text-gray-700\">Filters</label>\r\n                {filters.length === 0 && (\r\n                    <p className=\"text-sm text-gray-500\">No filters applied. Click \"Add Filter\" to begin.</p>\r\n                )}\r\n\r\n                {filters.map((filter) => (\r\n                    <div key={filter.id} className=\"flex flex-col md:flex-row items-center space-y-2 md:space-y-0 md:space-x-2\">\r\n                        {/* 1. Filter Type Dropdown */}\r\n                        <select\r\n                            aria-label=\"Filter type\"\r\n                            value={filter.type}\r\n                            onChange={(e) => updateFilter(filter.id, 'type', e.target.value)}\r\n                            className=\"p-2 border border-gray-300 rounded-lg w-full md:w-1/3 text-sm\"\r\n                            disabled={loading || optionsLoading}\r\n                        >\r\n                            <option value=\"\">-- Select Filter Type --</option>\r\n                            {Object.entries(FILTER_TYPES).map(([key, label]) => (\r\n                                <option key={key} value={key}>{label}</option>\r\n                            ))}\r\n                        </select>\r\n\r\n                        {/* 2. Filter Value Dropdown */}\r\n                        <select\r\n                            aria-label=\"Filter value\"\r\n                            value={filter.value}\r\n                            onChange={(e) => updateFilter(filter.id, 'value', e.target.value)}\r\n                            className=\"p-2 border border-gray-300 rounded-lg w-full md:w-2/3 text-sm\"\r\n                            disabled={!filter.type || loading || optionsLoading}\r\n                        >\r\n                            <option value=\"\">-- Select Value --</option>\r\n                            {getOptionsForFilterType(filter.type).map(option => (\r\n                                <option key={option} value={option}>\r\n                                    {option || '(Not Set)'}\r\n                                </option>\r\n                            ))}\r\n                        </select>\r\n\r\n                        {/* 3. Remove Button */}\r\n                        <button\r\n                            onClick={() => removeFilter(filter.id)}\r\n                            className=\"p-2 text-red-500 hover:text-red-700\"\r\n                            title=\"Remove filter\"\r\n                            disabled={loading || optionsLoading}\r\n                        >\r\n                            <FaTimes />\r\n                        </button>\r\n                    </div>\r\n                ))}\r\n\r\n                {/* 4. Add Button */}\r\n                <button\r\n                    onClick={addFilter}\r\n                    disabled={loading || optionsLoading}\r\n                    className=\"flex items-center px-4 py-2 text-sm rounded-lg transition duration-300 bg-sky-600 text-white hover:bg-sky-700 disabled:bg-gray-300\"\r\n                >\r\n                    <FaPlus className=\"mr-2\" />\r\n                    Add Filter\r\n                </button>\r\n            </div>\r\n            {/* --- END DYNAMIC FILTER ROW --- */}\r\n\r\n\r\n            <div className=\"bg-white rounded-lg shadow-lg overflow-x-auto\">\r\n                {error && (\r\n                    <div className=\"p-4 bg-red-100 text-red-700 border-l-4 border-red-500 flex items-center\">\r\n                        <FaExclamationTriangle className=\"mr-3 flex-shrink-0 text-xl\" />\r\n                        <div>\r\n                            <p className=\"font-semibold\">{error}</p>\r\n                            <p className=\"text-sm\">Please check the date range and ensure the scheduled job is running successfully to import new data.</p>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {loading && data.length === 0 ? (\r\n                    <div className=\"p-6 text-center text-gray-500\">\r\n                        <FaRedo className=\"mx-auto text-3xl mb-2 animate-spin\" />\r\n                        <p>Loading historical report for selected dates...</p>\r\n                    </div>\r\n                ) : (\r\n                    <table className=\"min-w-full divide-y divide-gray-200\">\r\n                        <thead className=\"bg-gray-50\">\r\n                            <tr>\r\n                                {columns.map(col => (\r\n                                    <th\r\n                                        key={col.key}\r\n                                        className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap\"\r\n                                    >\r\n                                        {col.title}\r\n                                    </th>\r\n                                ))}\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                            {data.length > 0 ? (\r\n                                data.map((item, index) => (\r\n                                    <tr key={item.id || index} className=\"hover:bg-sky-50/50\">\r\n                                        {columns.map(col => (\r\n                                            <td key={col.key} className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                {col.render(item)}\r\n                                            </td>\r\n                                        ))}\r\n                                    </tr>\r\n                                ))\r\n                            ) : (\r\n                                !error && !loading && (\r\n                                    <tr>\r\n                                        <td colSpan={columns.length} className=\"px-6 py-12 text-center text-gray-500\">\r\n                                            <FaChartBar className=\"mx-auto text-4xl mb-4 text-gray-400\" />\r\n                                            <p className=\"text-lg font-semibold\">No visitor data found for the selected criteria.</p>\r\n                                            <p className=\"text-sm\">Try adjusting the date range or removing some filters.</p>\r\n                                        </td>\r\n                                    </tr>\r\n                                )\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AudiencePage;"],"names":["DetailCell","_ref","icon","Icon","value","label","_jsxs","className","children","_jsx","title","FILTER_TYPES","country","region","city","operatingSystem","osVersion","sessionSource","FILTER_DEPENDENCIES","AudiencePage","data","setData","useState","loading","setLoading","optionsLoading","setOptionsLoading","error","setError","startDate","setStartDate","Date","getTime","toISOString","split","endDate","setEndDate","filters","setFilters","filterOptions","setFilterOptions","buildApiParams","useCallback","params","forEach","filter","type","useEffect","async","optionsResponse","dataResponse","Promise","all","getFilterOptions","getHistoricalAudienceData","err","console","response","status","fetchDataAndOptions","updateFilter","id","field","newValue","prevFilters","newFilters","filterIndex","findIndex","f","oldFilter","_objectSpread","dependencies","map","includes","columns","key","render","item","FaCalendarAlt","sessionDate","FaMapMarkedAlt","concat","FaMobileAlt","deviceCategory","deviceModel","FaGlobe","FaDesktop","screenResolution","landingPage","FaClock","timeOnSiteFormatted","FaChartBar","views","FaUser","userIdentifier","substring","getOptionsForFilterType","countries","regions","cities","operatingSystems","osVersions","sessionSources","htmlFor","onChange","e","target","disabled","FaRedo","length","Object","entries","_ref2","option","onClick","removeFilter","FaTimes","addFilter","now","FaPlus","FaExclamationTriangle","col","index","colSpan"],"sourceRoot":""}