{"version":3,"file":"static/js/106.5318914b.chunk.js","mappings":"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","sources":["pages/AudiencePage.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { getHistoricalAudienceData } from '../apiConfig';\r\nimport { FaCalendarAlt, FaMapMarkedAlt, FaMobileAlt, FaDesktop, FaClock, FaRedo, FaExclamationTriangle, FaChartBar, FaUser, FaGlobe, FaSearch } from 'react-icons/fa';\r\n\r\n// Helper component for table cell display\r\nconst DetailCell = ({ icon: Icon, value, label }) => (\r\n    <div className=\"flex items-center text-sm text-gray-700\">\r\n        <Icon className=\"text-sky-500 mr-2 flex-shrink-0\" title={label} />\r\n        <span className=\"truncate\" title={value || 'N/A'}>\r\n            {value || 'N/A'}\r\n        </span>\r\n    </div>\r\n);\r\n\r\n// Function to format today's date in YYYY-MM-DD format\r\nconst getTodayDateString = () => {\r\n    return new Date().toISOString().split('T')[0];\r\n};\r\n\r\nconst AudiencePage = () => {\r\n    const [data, setData] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n    const [startDate, setStartDate] = useState(getTodayDateString());\r\n    const [endDate, setEndDate] = useState(getTodayDateString());\r\n    const [lastFetchTime, setLastFetchTime] = useState(null);\r\n\r\n    const fetchData = async (start, end) => {\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        // Simple validation\r\n        if (!start || !end || new Date(start) > new Date(end)) {\r\n            setError('Invalid date range. Start date must be before or equal to the end date.');\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await getHistoricalAudienceData(start, end);\r\n            setData(response.data);\r\n            setLastFetchTime(new Date());\r\n        } catch (err) {\r\n            console.error('Error fetching audience data:', err);\r\n            if (err.response && (err.response.status === 403 || err.response.status === 401)) {\r\n                setError('Access Denied. You do not have permission to view this data.');\r\n            } else {\r\n                setError('Failed to fetch historical audience data. Check backend logs and GA4 setup. The last attempt to fetch historical data might have failed.');\r\n            }\r\n            setData([]);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // Initial fetch when component mounts: loads last 7 days of data\r\n    useEffect(() => {\r\n        const today = new Date();\r\n        const defaultStart = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];\r\n        setStartDate(defaultStart);\r\n        fetchData(defaultStart, getTodayDateString());\r\n    }, []);\r\n\r\n    const handleDateChange = (e, type) => {\r\n        const value = e.target.value;\r\n        if (type === 'start') {\r\n            setStartDate(value);\r\n        } else {\r\n            setEndDate(value);\r\n        }\r\n    };\r\n\r\n    const handleSearchClick = () => {\r\n        fetchData(startDate, endDate);\r\n    };\r\n\r\n    const columns = [\r\n        {\r\n            key: 'sessionDate',\r\n            title: 'Date',\r\n            render: (item) => <DetailCell icon={FaCalendarAlt} value={item.sessionDate} label=\"Session Date\" />\r\n        },\r\n        {\r\n            key: 'location',\r\n            title: 'Location (City, Region, Country)',\r\n            render: (item) => (\r\n                <DetailCell\r\n                    icon={FaMapMarkedAlt}\r\n                    value={`${item.city || 'N/A'}, ${item.region || 'N/A'}, ${item.country || 'N/A'}`}\r\n                    label=\"Location\"\r\n                />\r\n            )\r\n        },\r\n        {\r\n            key: 'device',\r\n            title: 'Device & OS',\r\n            render: (item) => (\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-700 font-semibold\">\r\n                        <FaMobileAlt className=\"inline mr-1 text-sky-500\" /> {item.deviceCategory} ({item.deviceModel || 'N/A'})\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        <FaGlobe className=\"inline mr-1 text-sky-500\" /> {item.operatingSystem} ({item.osVersion || 'N/A'})\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        <FaDesktop className=\"inline mr-1 text-sky-500\" /> Resolution: {item.screenResolution || 'N/A'}\r\n                    </p>\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            key: 'traffic',\r\n            title: 'Source & Landing Page',\r\n            render: (item) => (\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-700 font-semibold\">Source: {item.sessionSource}</p>\r\n                    <p className=\"text-xs text-gray-500 truncate max-w-xs\" title={item.landingPage}>Landing: {item.landingPage}</p>\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            key: 'time',\r\n            title: 'Time & Views',\r\n            render: (item) => (\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-700 font-semibold\">\r\n                        <FaClock className=\"inline mr-1 text-sky-500\" /> {item.timeOnSiteFormatted}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        <FaChartBar className=\"inline mr-1 text-sky-500\" /> Sessions: {item.views}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        <FaUser className=\"inline mr-1 text-sky-500\" /> ID: {item.userIdentifier ? item.userIdentifier.substring(0, 8) + '...' : 'N/A'}\r\n                    </p>\r\n                </div>\r\n            )\r\n        }\r\n    ];\r\n\r\n    return (\r\n        <div className=\"container mx-auto p-6 md:p-8\">\r\n            <h1 className=\"text-3xl font-bold text-gray-800 mb-4\">Historical Audience Report</h1>\r\n            <p className=\"text-gray-600 mb-6\">Detailed visitor logs stored in the database. Data is synchronized daily from Google Analytics (GA4).</p>\r\n\r\n            <div className=\"bg-white p-4 rounded-lg shadow-sm mb-6 flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4\">\r\n                <div className=\"flex items-center space-x-2 w-full md:w-auto\">\r\n                    <label htmlFor=\"startDate\" className=\"text-sm font-medium text-gray-700 flex-shrink-0\">From:</label>\r\n                    <input\r\n                        type=\"date\"\r\n                        id=\"startDate\"\r\n                        value={startDate}\r\n                        onChange={(e) => handleDateChange(e, 'start')}\r\n                        className=\"p-2 border border-gray-300 rounded-lg w-full text-sm\"\r\n                        disabled={loading}\r\n                    />\r\n                </div>\r\n                <div className=\"flex items-center space-x-2 w-full md:w-auto\">\r\n                    <label htmlFor=\"endDate\" className=\"text-sm font-medium text-gray-700 flex-shrink-0\">To:</label>\r\n                    <input\r\n                        type=\"date\"\r\n                        id=\"endDate\"\r\n                        value={endDate}\r\n                        onChange={(e) => handleDateChange(e, 'end')}\r\n                        className=\"p-2 border border-gray-300 rounded-lg w-full text-sm\"\r\n                        disabled={loading}\r\n                    />\r\n                </div>\r\n                <button\r\n                    onClick={handleSearchClick}\r\n                    disabled={loading}\r\n                    className={`flex items-center px-4 py-2 text-sm rounded-lg transition duration-300 w-full md:w-auto justify-center ${loading\r\n                            ? 'bg-gray-300 text-gray-600 cursor-not-allowed'\r\n                            : 'bg-sky-600 text-white hover:bg-sky-700'\r\n                        }`}\r\n                >\r\n                    <FaSearch className={`mr-2 ${loading ? 'animate-pulse' : ''}`} />\r\n                    {loading ? 'Fetching...' : 'Filter Data'}\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"bg-white rounded-lg shadow-lg overflow-x-auto\">\r\n                {error && (\r\n                    <div className=\"p-4 bg-red-100 text-red-700 border-l-4 border-red-500 flex items-center\">\r\n                        <FaExclamationTriangle className=\"mr-3 flex-shrink-0 text-xl\" />\r\n                        <div>\r\n                            <p className=\"font-semibold\">{error}</p>\r\n                            <p className=\"text-sm\">Please check the date range and ensure the scheduled job is running successfully to import new data.</p>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {loading && data.length === 0 ? (\r\n                    <div className=\"p-6 text-center text-gray-500\">\r\n                        <FaRedo className=\"mx-auto text-3xl mb-2 animate-spin\" />\r\n                        <p>Loading historical report for selected dates...</p>\r\n                    </div>\r\n                ) : (\r\n                    <table className=\"min-w-full divide-y divide-gray-200\">\r\n                        <thead className=\"bg-gray-50\">\r\n                            <tr>\r\n                                {columns.map(col => (\r\n                                    <th\r\n                                        key={col.key}\r\n                                        className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap\"\r\n                                    >\r\n                                        {col.title}\r\n                                    </th>\r\n                                ))}\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                            {data.length > 0 ? (\r\n                                data.map((item, index) => (\r\n                                    <tr key={item.id || index} className=\"hover:bg-sky-50/50\">\r\n                                        {columns.map(col => (\r\n                                            <td key={col.key} className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                {col.render(item)}\r\n                                            </td>\r\n                                        ))}\r\n                                    </tr>\r\n                                ))\r\n                            ) : (\r\n                                !error && (\r\n                                    <tr>\r\n                                        <td colSpan={columns.length} className=\"px-6 py-12 text-center text-gray-500\">\r\n                                            <FaChartBar className=\"mx-auto text-4xl mb-4 text-gray-400\" />\r\n                                            <p className=\"text-lg font-semibold\">No visitor data found for the selected date range.</p>\r\n                                            <p className=\"text-sm\">If this is the first day after implementation, initial data might be pending synchronization. Check back tomorrow.</p>\r\n                                        </td>\r\n                                    </tr>\r\n                                )\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AudiencePage;"],"names":["DetailCell","_ref","icon","Icon","value","label","_jsxs","className","children","_jsx","title","getTodayDateString","Date","toISOString","split","AudiencePage","data","setData","useState","loading","setLoading","error","setError","startDate","setStartDate","endDate","setEndDate","lastFetchTime","setLastFetchTime","fetchData","async","start","end","response","getHistoricalAudienceData","err","console","status","useEffect","today","defaultStart","getTime","handleDateChange","e","type","target","columns","key","render","item","FaCalendarAlt","sessionDate","FaMapMarkedAlt","concat","city","region","country","FaMobileAlt","deviceCategory","deviceModel","FaGlobe","operatingSystem","osVersion","FaDesktop","screenResolution","sessionSource","landingPage","FaClock","timeOnSiteFormatted","FaChartBar","views","FaUser","userIdentifier","substring","htmlFor","id","onChange","disabled","onClick","handleSearchClick","FaSearch","FaExclamationTriangle","length","FaRedo","map","col","index","colSpan"],"sourceRoot":""}