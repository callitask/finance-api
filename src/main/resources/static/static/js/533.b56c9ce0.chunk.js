(self.webpackChunktreishvaam_finance_frontend=self.webpackChunktreishvaam_finance_frontend||[]).push([[533],{2024:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>A});var s=a(5043),l=a(1045),n=a(1641),r=a(6355);const o=e=>new Promise(t=>e.toBlob(e=>t(e),"image/webp",.9)),i=()=>"group_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));var d=a(1586),c=(a(9576),a(579));const u=e=>{let{src:t,type:a,onClose:l,onSave:n,aspect:r}=e;const o=(0,s.useRef)(null),i=(0,s.useRef)(null),[u,m]=(0,s.useState)(),[h,g]=(0,s.useState)();(0,s.useEffect)(()=>{null!==h&&void 0!==h&&h.width&&o.current&&i.current&&function(e,t,a){const s=t.getContext("2d");if(!s||!a.width||!a.height)return;const l=e.naturalWidth/e.width,n=e.naturalHeight/e.height,r=window.devicePixelRatio||1;t.width=Math.floor(a.width*l*r),t.height=Math.floor(a.height*n*r),s.scale(r,r),s.imageSmoothingQuality="high";const o=a.x*l,i=a.y*n;s.drawImage(e,o,i,a.width*l,a.height*n,0,0,a.width*l,a.height*n)}(o.current,i.current,h)},[h]);return(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:(0,c.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full",children:[(0,c.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Crop Image"}),(0,c.jsx)("div",{style:{maxHeight:"60vh",overflowY:"auto"},children:(0,c.jsx)(d.Ay,{crop:u,onChange:e=>m(e),onComplete:e=>g(e),aspect:r,children:(0,c.jsx)("img",{ref:o,alt:"Crop",src:t})})}),(0,c.jsx)("canvas",{ref:i,className:"hidden"}),(0,c.jsxs)("div",{className:"flex justify-end gap-4 mt-4",children:[(0,c.jsx)("button",{onClick:l,className:"px-4 py-2 rounded bg-gray-200 hover:bg-gray-300",children:"Cancel"}),(0,c.jsx)("button",{onClick:()=>{h&&i.current&&n(i.current,h)},className:"px-4 py-2 rounded bg-sky-600 text-white hover:bg-sky-700",children:"Save"})]})]})})},m=e=>{let{isOpen:t,onChoice:a}=e;return t?(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:(0,c.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center",children:[(0,c.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Square Image Detected"}),(0,c.jsx)("p",{className:"text-gray-600 mb-6",children:"For subsequent images in this story, how should they be cropped?"}),(0,c.jsxs)("div",{className:"flex justify-center gap-4 mt-4",children:[(0,c.jsx)("button",{onClick:()=>a("landscape"),className:"px-4 py-2 rounded bg-sky-600 text-white hover:bg-sky-700",children:"Lock Height (Landscape Style)"}),(0,c.jsx)("button",{onClick:()=>a("portrait"),className:"px-4 py-2 rounded bg-sky-600 text-white hover:bg-sky-700",children:"Lock Width (Portrait Style)"})]})]})}):null},h=e=>{let{images:t,isOpen:a,onClose:l,onSelect:n}=e;const[r,o]=(0,s.useState)([]);if(!a)return null;return(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:(0,c.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-4xl w-full",children:[(0,c.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Select Images from Post"}),(0,c.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-4 max-h-96 overflow-y-auto p-2",children:t.map((e,t)=>(0,c.jsxs)("div",{onClick:()=>(e=>o(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e]))(e),className:"relative rounded-lg overflow-hidden cursor-pointer border-4 ".concat(r.includes(e)?"border-sky-500":"border-transparent"),children:[(0,c.jsx)("img",{src:e,alt:"Post content ".concat(t+1),className:"w-full h-full object-cover"}),r.includes(e)&&(0,c.jsx)("div",{className:"absolute inset-0 bg-sky-500 bg-opacity-50 flex items-center justify-center text-white text-2xl",children:"\u2713"})]},t))}),(0,c.jsxs)("div",{className:"flex justify-end gap-4 mt-4",children:[(0,c.jsx)("button",{onClick:l,className:"px-4 py-2 rounded bg-gray-200 hover:bg-gray-300",children:"Cancel"}),(0,c.jsx)("button",{onClick:()=>{n(r),o([])},className:"px-4 py-2 rounded bg-sky-600 text-white hover:bg-sky-700",children:"Add Selected"})]})]})})},g=e=>{let{title:t,onTitleChange:a,userFriendlySlug:s,onUserFriendlySlugChange:l}=e;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"title",className:"block text-gray-700 font-semibold mb-2",children:"Title"}),(0,c.jsx)("input",{type:"text",id:"title",value:t,onChange:e=>a(e.target.value),className:"w-full p-2 border border-gray-300 rounded",required:!0})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"userFriendlySlug",className:"block text-gray-700 font-semibold mb-2",children:"URL Slug (SEO Friendly)"}),(0,c.jsx)("input",{type:"text",id:"userFriendlySlug",value:s,onChange:e=>l(e.target.value),placeholder:"e.g., guide-to-market-analysis",className:"w-full p-2 border border-gray-300 rounded"})]})]})},p=e=>{let{keywords:t,onKeywordsChange:a,metaDescription:s,onMetaDescriptionChange:l,customSnippet:n,onCustomSnippetChange:r}=e;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"keywords",className:"block text-gray-700 font-semibold mb-2",children:"Keywords (Comma-separated)"}),(0,c.jsx)("input",{type:"text",id:"keywords",value:t,onChange:e=>a(e.target.value),className:"w-full p-2 border border-gray-300 rounded",placeholder:"e.g., investing, stocks, financial freedom"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"metaDescription",className:"block text-gray-700 font-semibold mb-2",children:"Meta Description (for SEO)"}),(0,c.jsx)("textarea",{id:"metaDescription",value:s,onChange:e=>l(e.target.value),rows:"3",className:"w-full p-2 border border-gray-300 rounded",placeholder:"A brief summary for search engines (about 155 characters)."})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"customSnippet",className:"block text-gray-700 font-semibold mb-2",children:"Custom Snippet (for Previews)"}),(0,c.jsx)("textarea",{id:"customSnippet",value:n,onChange:e=>r(e.target.value),rows:"3",className:"w-full p-2 border border-gray-300 rounded",placeholder:"A short preview for display on the blog page."})]})]})},x=e=>{let{selectedCategory:t,onCategoryChange:a,allCategories:s,showNewCategoryInput:l,onShowNewCategoryToggle:n,newCategoryName:r,onNewCategoryNameChange:o,onAddNewCategory:i}=e;return(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"category",className:"block text-gray-700 font-semibold mb-2",children:"Category"}),(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsxs)("select",{id:"category",value:t?t.name:"",onChange:e=>{const t=s.find(t=>t.name===e.target.value);a(t)},className:"w-full p-2 border border-gray-300 rounded",children:[(0,c.jsx)("option",{value:"",children:"Select a category"}),s&&s.map(e=>(0,c.jsx)("option",{value:e.name,children:e.name},e.id))]}),(0,c.jsx)("button",{type:"button",onClick:n,className:"p-2 bg-gray-200 rounded hover:bg-gray-300 text-lg font-bold",children:"+"})]}),l&&(0,c.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,c.jsx)("input",{type:"text",value:r,onChange:e=>o(e.target.value),placeholder:"New category name",className:"w-full p-2 border border-gray-300 rounded"}),(0,c.jsx)("button",{type:"button",onClick:i,className:"px-4 py-2 bg-sky-600 text-white rounded hover:bg-sky-700",children:"Add"})]})]})},b=e=>{let{tags:t,setTags:a}=e;const[l,n]=(0,s.useState)(""),r=()=>{const e=l.trim().replace(/,/g,"");e&&!t.includes(e)&&a([...t,e]),n("")};return(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:t.map(e=>(0,c.jsxs)("div",{className:"bg-sky-100 text-sky-800 text-sm font-semibold px-2 py-1 rounded-full flex items-center",children:[(0,c.jsx)("span",{children:e}),(0,c.jsx)("button",{type:"button",onClick:()=>{return s=e,a(t.filter(e=>e!==s));var s},className:"ml-2 text-sky-600 hover:text-sky-900",children:"\xd7"})]},e))}),(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsx)("input",{type:"text",value:l,onChange:e=>n(e.target.value),onKeyDown:e=>{"Enter"!==e.key&&","!==e.key||(e.preventDefault(),r())},placeholder:"Add a tag",className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-sky-200"}),(0,c.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 bg-sky-600 text-white rounded hover:bg-sky-700",children:"Add"})]})]})},y=e=>{let{layoutStyle:t,onLayoutStyleChange:a,tags:s,onTagsChange:l}=e;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"layoutStyle",className:"block text-gray-700 font-semibold mb-2",children:"Layout Style"}),(0,c.jsxs)("select",{id:"layoutStyle",value:t,onChange:a,className:"w-full p-2 border border-gray-300 rounded",children:[(0,c.jsx)("option",{value:"DEFAULT",children:"Default (Masonry)"}),(0,c.jsx)("option",{value:"BANNER",children:"Banner"}),(0,c.jsx)("option",{value:"MULTI_COLUMN_2",children:"2 Column Row"}),(0,c.jsx)("option",{value:"MULTI_COLUMN_3",children:"3 Column Row"}),(0,c.jsx)("option",{value:"MULTI_COLUMN_4",children:"4 Column Row"}),(0,c.jsx)("option",{value:"MULTI_COLUMN_5",children:"5 Column Row"}),(0,c.jsx)("option",{value:"MULTI_COLUMN_6",children:"6 Column Row"})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-gray-700 font-semibold mb-2",children:"Tags"}),(0,c.jsx)(b,{tags:s,setTags:l})]})]})};var f=a(335),v=a(7537),j=a(5964),w=a(2734);const C=e=>{let{id:t,thumbnail:a,index:l,moveThumbnail:n,onRemove:r,onAltTextChange:o}=e;const i=(0,s.useRef)(null),[,d]=(0,j.H)({accept:"thumbnail",hover(e){i.current&&e.index!==l&&(n(e.index,l),e.index=l)}}),[{isDragging:u},m]=(0,w.i)({type:"thumbnail",item:{type:"thumbnail",id:t,index:l},collect:e=>({isDragging:e.isDragging()})});return m(d(i)),(0,c.jsxs)("div",{ref:i,style:{opacity:u?.5:1},className:"p-2 border rounded-lg bg-white flex items-start gap-3",children:[(0,c.jsx)("img",{src:a.preview,alt:"preview",className:"w-24 h-24 object-cover rounded-md flex-shrink-0"}),(0,c.jsxs)("div",{className:"flex-grow",children:[(0,c.jsx)("input",{type:"text",value:a.altText||"",onChange:e=>o(l,e.target.value),placeholder:"Alt text",className:"w-full p-2 text-sm border border-gray-300 rounded mb-2"}),(0,c.jsx)("button",{type:"button",onClick:()=>r(l),className:"text-xs text-red-600 hover:underline",children:"Remove"})]})]})},N=e=>{let{thumbnails:t,setThumbnails:a,onUploadClick:l,onAddFromPostClick:n}=e;const r=(0,s.useCallback)((e,t)=>{a(a=>{const s=[...a],[l]=s.splice(e,1);return s.splice(t,0,l),s})},[a]),o=e=>a(t=>t.filter((t,a)=>a!==e)),i=(e,t)=>{a(a=>{const s=[...a];return s[e].altText=t,s})};return(0,c.jsx)(f.Q,{backend:v.t2,children:(0,c.jsxs)("div",{className:"p-4 border rounded-lg space-y-4 bg-gray-50",children:[(0,c.jsx)("div",{className:"space-y-3 max-h-64 overflow-y-auto pr-2",children:t.length>0?t.map((e,t)=>(0,c.jsx)(C,{index:t,id:e.id||t,thumbnail:e,moveThumbnail:r,onRemove:o,onAltTextChange:i},e.id||t)):(0,c.jsx)("p",{className:"text-center text-gray-500 text-sm py-4",children:"No story thumbnails yet."})}),(0,c.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,c.jsxs)("button",{type:"button",onClick:l,className:"flex-1 flex items-center justify-center gap-2 text-sm p-2 rounded-lg font-semibold bg-sky-50 text-sky-700 hover:bg-sky-100",children:[(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Upload New"]}),(0,c.jsxs)("button",{type:"button",onClick:n,className:"flex-1 flex items-center justify-center gap-2 text-sm p-2 rounded-lg font-semibold bg-gray-100 text-gray-700 hover:bg-gray-200",children:[(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),"Add from Post"]})]})]})})},k=e=>{let{thumbnailMode:t,onThumbnailModeChange:a,thumbPreview:s,onUploadSingleClick:l,thumbnailAltText:n,onThumbnailAltTextChange:r,storyThumbnails:o,setStoryThumbnails:i,onUploadStoryClick:d,onAddFromPostClick:u}=e;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"my-4",children:[(0,c.jsx)("label",{className:"block text-gray-700 font-semibold mb-2",children:"Thumbnail Mode"}),(0,c.jsxs)("div",{className:"flex rounded-lg p-1 bg-gray-200",children:[(0,c.jsx)("button",{type:"button",onClick:()=>a("single"),className:"flex-1 p-2 rounded-md text-sm font-semibold transition ".concat("single"===t?"bg-white text-sky-600 shadow":"text-gray-600"),children:"Single Image"}),(0,c.jsx)("button",{type:"button",onClick:()=>a("story"),className:"flex-1 p-2 rounded-md text-sm font-semibold transition ".concat("story"===t?"bg-white text-sky-600 shadow":"text-gray-600"),children:"Story Thumbnails"})]})]}),"single"===t?(0,c.jsxs)("div",{className:"p-4 border rounded-lg space-y-3 bg-gray-50",children:[(0,c.jsx)("label",{className:"block text-gray-700 font-semibold",children:"Thumbnail Image"}),s&&(0,c.jsx)("img",{src:s,alt:"Thumbnail Preview",className:"w-full h-auto aspect-video object-contain my-4 border rounded-lg bg-white"}),(0,c.jsx)("button",{type:"button",onClick:l,className:"w-full text-sm p-2 rounded-lg font-semibold bg-sky-50 text-sky-700 hover:bg-sky-100",children:"Upload Thumbnail"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"thumbnailAltText",className:"text-sm font-medium text-gray-600",children:"Alt Text"}),(0,c.jsx)("input",{type:"text",id:"thumbnailAltText",value:n,onChange:e=>r(e.target.value),placeholder:"Describe the image for SEO",className:"w-full mt-1 p-2 text-sm border border-gray-300 rounded"})]})]}):(0,c.jsx)(N,{thumbnails:o,setThumbnails:i,onUploadClick:d,onAddFromPostClick:u})]})},S=e=>{let{coverPreview:t,onUploadCoverClick:a,coverImageAltText:s,onCoverImageAltTextChange:l}=e;return(0,c.jsxs)("div",{className:"p-4 border rounded-lg space-y-3 bg-gray-50",children:[(0,c.jsx)("label",{className:"block text-gray-700 font-semibold",children:"Cover Image"}),t&&(0,c.jsx)("img",{src:t,alt:"Cover Preview",className:"w-full h-auto aspect-video object-contain my-4 border rounded-lg bg-white"}),(0,c.jsx)("button",{type:"button",onClick:a,className:"w-full text-sm p-2 rounded-lg font-semibold bg-sky-50 text-sky-700 hover:bg-sky-100",children:"Upload Cover Image"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"coverImageAltText",className:"text-sm font-medium text-gray-600",children:"Cover Image Alt Text"}),(0,c.jsx)("input",{type:"text",id:"coverImageAltText",value:s,onChange:e=>l(e.target.value),placeholder:"Describe the cover image for SEO",className:"w-full mt-1 p-2 text-sm border border-gray-300 rounded"})]})]})},T=e=>{let{scheduledTime:t,onScheduledTimeChange:a,isFeatured:s,onIsFeaturedChange:l,isUpdating:n}=e;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"scheduledTime",className:"block text-gray-700 font-semibold mb-2",children:"Schedule Publication"}),(0,c.jsx)("input",{type:"datetime-local",id:"scheduledTime",value:t,onChange:e=>a(e.target.value),className:"w-full p-2 border border-gray-300 rounded"}),(0,c.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Leave blank to publish immediately."})]}),(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("input",{type:"checkbox",checked:s,onChange:e=>l(e.target.checked),className:"h-5 w-5 text-sky-600 border-gray-300 rounded focus:ring-sky-500"}),(0,c.jsx)("span",{className:"ml-2 text-gray-700",children:"Mark as Featured"})]}),(0,c.jsx)("button",{type:"submit",className:"w-full bg-sky-600 text-white font-bold py-3 rounded-lg hover:bg-sky-700 transition",children:n?"Update Post":"Publish Post"})]})};a(3475);var U=a(9266);const F=s.lazy(()=>Promise.resolve().then(a.t.bind(a,9266,23))),L=e=>{let{content:t,onContentChange:a,editorRef:l,onImageUploadBefore:n,onLoad:r}=e;return(0,c.jsxs)("div",{className:"w-full md:w-2/3 p-6 flex flex-col h-full overflow-y-auto",children:[(0,c.jsx)("label",{className:"block text-gray-700 font-semibold mb-2",children:"Content"}),(0,c.jsx)("div",{className:"flex-grow h-full",children:(0,c.jsx)(s.Suspense,{fallback:(0,c.jsx)("div",{children:"Loading editor..."}),children:(0,c.jsx)(F,{setContents:t,onChange:a,getSunEditorInstance:e=>{l.current=e},onImageUploadBefore:n,onLoad:r,setOptions:{height:"auto",minHeight:"400px",buttonList:U.buttonList.complex,pasteKeepFormats:!0,pasteTagsWhitelist:".*"}})})})]})},A=()=>{const{id:e}=(0,l.g)(),t=(0,l.Zp)(),[a,d]=(0,s.useState)(null),[b,f]=(0,s.useState)("Idle"),[v,j]=(0,s.useState)(""),[w,C]=(0,s.useState)(""),[N,U]=(0,s.useState)(null),[F,A]=(0,s.useState)(!1),[O,I]=(0,s.useState)([]),[M,D]=(0,s.useState)(""),[R,P]=(0,s.useState)([]),[E,_]=(0,s.useState)(!1),[H,W]=(0,s.useState)(""),[z,B]=(0,s.useState)({isOpen:!1,type:null,src:"",aspect:void 0}),[q,K]=(0,s.useState)(""),[J,G]=(0,s.useState)(""),[Q,V]=(0,s.useState)(""),[$,Y]=(0,s.useState)(""),[Z,X]=(0,s.useState)(""),[ee,te]=(0,s.useState)("single"),[ae,se]=(0,s.useState)([]),[le,ne]=(0,s.useState)(null),[re,oe]=(0,s.useState)(null),[ie,de]=(0,s.useState)(!1),[ce,ue]=(0,s.useState)([]),[me,he]=(0,s.useState)(""),[ge,pe]=(0,s.useState)(null),[xe,be]=(0,s.useState)(""),[ye,fe]=(0,s.useState)(null),[ve,je]=(0,s.useState)(null),[we,Ce]=(0,s.useState)(""),[Ne,ke]=(0,s.useState)(!1),[Se,Te]=(0,s.useState)(null),[Ue,Fe]=(0,s.useState)("DEFAULT"),[Le,Ae]=(0,s.useState)(null),[Oe,Ie]=(0,s.useState)(""),Me=(0,s.useRef)(null),De=(0,s.useRef)(null),Re=(0,s.useRef)(!1),Pe=(0,s.useRef)(null);(0,s.useEffect)(()=>{(async()=>{try{const a=await(0,r.bW)();if(Array.isArray(a.data)&&P(a.data),e){const t=(await(0,r.f5)(e)).data;if(d(t.id),j(t.title),C(t.content),t.category&&a.data){const e=a.data.find(e=>e.name===t.category.name);U(e||null)}if(I(t.tags||[]),A(t.featured),G(t.customSnippet||""),V(t.metaDescription||""),Y(t.keywords||""),X(t.coverImageAltText||""),Ie(t.userFriendlySlug||""),Fe(t.layoutStyle||"DEFAULT"),Ae(t.layoutGroupId||null),t.thumbnails&&t.thumbnails.length>0){te("story");const e=t.thumbnailOrientation||"landscape";ne(e),oe("landscape"===e?16/9:.8);const a=t.thumbnails.map(e=>({id:e.id,preview:"".concat(r.H$,"/api/uploads/").concat(e.imageUrl,"-small.webp"),altText:e.altText||"",source:"existing",url:e.imageUrl,file:null})).sort((e,t)=>e.displayOrder-t.displayOrder);se(a)}t.coverImageUrl&&be("".concat(r.H$,"/api/uploads/").concat(t.coverImageUrl,".webp")),t.scheduledTime&&K(new Date(t.scheduledTime).toISOString().slice(0,16))}else{var t;(null===(t=a.data)||void 0===t?void 0:t.length)>0&&U(a.data[0])}}catch(a){D("Failed to load initial data."),console.error(a)}})()},[e]);const Ee=(0,s.useCallback)(async()=>{if(v.trim()||w.trim()){f("Saving...");try{const e=Me.current?Me.current.getContents(!0):w,s={title:v,content:e,customSnippet:J,metaDescription:Q,keywords:$};if(a)await(0,r.jA)(a,s);else{const e=await(0,r.mq)(s);d(e.data.id),t("/dashboard/blog/edit/".concat(e.data.userFriendlySlug,"/").concat(e.data.id),{replace:!0})}f("Saved")}catch(e){f("Error"),console.error("Auto-save failed:",e)}}},[v,w,J,Q,$,a,t]);(0,s.useEffect)(()=>(Pe.current&&clearTimeout(Pe.current),Pe.current=setTimeout(()=>Ee(),2e3),()=>clearTimeout(Pe.current)),[v,w,J,Q,$,Ee]);const _e=async e=>{if(!e)return null;const t={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0,fileType:"image/webp"};try{return await(0,n.A)(e,t)}catch(a){return e}},He=(e,t,a)=>{if(e.target.files&&e.target.files.length>0){const s=new FileReader;s.addEventListener("load",()=>{var e;return B({isOpen:!0,type:t,src:(null===(e=s.result)||void 0===e?void 0:e.toString())||"",aspect:a})}),s.readAsDataURL(e.target.files[0])}e.target.value=null},We=async e=>{const t=await o(e),a=await _e(t),s=URL.createObjectURL(a),l={id:"new-".concat(Date.now()),preview:s,altText:"",source:"new",file:new File([a],"thumbnail-".concat(Date.now(),".webp"),{type:"image/webp"})};se(e=>[...e,l])};return(0,c.jsxs)("div",{className:"flex flex-col h-screen bg-gray-50 overflow-hidden",children:[(0,c.jsx)("input",{type:"file",ref:De,className:"hidden",accept:"image/*"}),(0,c.jsx)(h,{images:ce,isOpen:ie,onClose:()=>de(!1),onSelect:e=>{const t=e.map(e=>({id:"existing-".concat(e,"-").concat(Date.now()),preview:e,altText:"",source:"existing",file:null,url:new URL(e).pathname.replace("/api/uploads/","")}));se([...ae,...t]),de(!1)}}),z.isOpen&&(0,c.jsx)(u,{src:z.src,type:z.type,onClose:()=>B({isOpen:!1,type:null,src:"",aspect:void 0}),onSave:async(e,t)=>{if(B({isOpen:!1,type:null,src:"",aspect:void 0}),"story-thumbnail"===z.type)if(le)We(e);else{const{width:a,height:s}=t,l=a/s;if(l>.95&&l<1.05)return Te({canvas:e}),void ke(!0);ne(a>s?"landscape":"portrait"),oe(l),We(e)}else{const t=await o(e),a=await _e(t),s=URL.createObjectURL(a);if("single-thumbnail"===z.type)pe(a),he(s);else if("cover"===z.type)fe(a),be(s);else if("suneditor"===z.type&&ve){const e=new FormData;e.append("file",a,"image.webp"),(0,r.QM)(e).then(e=>ve(e.data)).catch(e=>{alert("Image upload failed in editor."),ve()})}}},aspect:z.aspect}),(0,c.jsx)(m,{isOpen:Ne,onChoice:e=>{const t="landscape"===e?16/9:.8;ne(e),oe(t),Se&&We(Se.canvas),ke(!1),Te(null)}}),(0,c.jsxs)("div",{className:"flex flex-col md:flex-row flex-grow overflow-hidden",children:[(0,c.jsxs)("div",{className:"w-full md:w-1/3 p-6 bg-white border-r border-gray-200 flex flex-col overflow-y-auto",style:{maxHeight:"100vh"},children:[(0,c.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,c.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:a?"Edit Post":"Create New Post"}),(0,c.jsxs)("div",{className:"text-sm",children:["Saving..."===b&&(0,c.jsx)("span",{className:"text-gray-500",children:"Saving..."}),"Saved"===b&&(0,c.jsx)("span",{className:"text-green-600",children:"Saved"}),"Error"===b&&(0,c.jsx)("span",{className:"text-red-600",children:"Save Error!"})]})]}),M&&(0,c.jsx)("p",{className:"text-red-500 bg-red-100 p-3 rounded mb-4",children:M}),(0,c.jsxs)("form",{id:"blog-editor-form",onSubmit:async e=>{if(e.preventDefault(),D(""),!Me.current)return D("Editor is not yet available.");if(!N)return D("Please select a category.");const s=new FormData;if(s.append("title",v),s.append("content",Me.current.getContents(!0)),s.append("category",N.name),s.append("featured",F),s.append("customSnippet",J),s.append("metaDescription",Q),s.append("keywords",$),s.append("coverImageAltText",Z),O.forEach(e=>s.append("tags",e)),q&&s.append("scheduledTime",new Date(q).toISOString()),ye&&s.append("coverImage",ye),s.append("layoutStyle",Ue),Ue.startsWith("MULTI_COLUMN")?s.append("layoutGroupId",Le||i()):s.append("layoutGroupId",""),s.append("userFriendlySlug",Oe),"story"===ee){s.append("thumbnailOrientation",le);const e=ae.map((e,t)=>({source:e.source,fileName:"new"===e.source?e.file.name:null,url:"existing"===e.source?e.url:null,altText:e.altText,displayOrder:t}));s.append("thumbnailMetadata",JSON.stringify(e)),ae.forEach(e=>{"new"===e.source&&s.append("newThumbnails",e.file)})}else if(ge){const e=[{source:"new",fileName:"thumbnail.webp",altText:we,displayOrder:0}];s.append("thumbnailMetadata",JSON.stringify(e)),s.append("newThumbnails",ge,"thumbnail.webp")}else if(me){const e=[{source:"existing",url:new URL(me).pathname.replace("/api/uploads/","").replace("-small.webp",""),altText:we,displayOrder:0}];s.append("thumbnailMetadata",JSON.stringify(e))}else s.append("thumbnailMetadata",JSON.stringify([]));try{a?await(0,r.gg)(a,s):await(0,r.pD)(s),t("/dashboard/manage-posts")}catch(l){D("Failed to save the post. Check console for details."),console.error(l)}},className:"flex flex-col gap-6 flex-grow",children:[(0,c.jsx)(g,{title:v,onTitleChange:j,userFriendlySlug:Oe,onUserFriendlySlugChange:Ie}),(0,c.jsx)(p,{keywords:$,onKeywordsChange:Y,metaDescription:Q,onMetaDescriptionChange:V,customSnippet:J,onCustomSnippetChange:G}),(0,c.jsx)(x,{selectedCategory:N,onCategoryChange:U,allCategories:R,showNewCategoryInput:E,onShowNewCategoryToggle:()=>_(!E),newCategoryName:H,onNewCategoryNameChange:W,onAddNewCategory:async()=>{if(!H)return;if(R.some(e=>e.name.toLowerCase()===H.toLowerCase()))return alert("Category name cannot be a duplicate.");try{const e=await(0,r.Ah)({name:H});P([...R,e.data]),U(e.data),W(""),_(!1)}catch(e){D("Failed to add new category."),console.error(e)}}}),(0,c.jsx)(y,{layoutStyle:Ue,onLayoutStyleChange:e=>{const t=e.target.value;Fe(t),t.startsWith("MULTI_COLUMN")?Le||Ae(i()):Ae(null)},tags:O,onTagsChange:I}),(0,c.jsx)(k,{thumbnailMode:ee,onThumbnailModeChange:te,thumbPreview:me,thumbnailAltText:we,onThumbnailAltTextChange:Ce,onUploadSingleClick:()=>{De.current.multiple=!1,De.current.onchange=e=>He(e,"single-thumbnail"),De.current.click()},storyThumbnails:ae,setStoryThumbnails:se,onAddFromPostClick:()=>{if(!Me.current)return;const e=Me.current.getContents(!0),t=(new DOMParser).parseFromString(e,"text/html"),a=Array.from(t.querySelectorAll("img")).map(e=>e.src);ue(a),de(!0)},onUploadStoryClick:()=>{De.current.multiple=!1,De.current.onchange=e=>He(e,"story-thumbnail",re),De.current.click()}}),(0,c.jsx)(S,{coverPreview:xe,coverImageAltText:Z,onCoverImageAltTextChange:X,onUploadCoverClick:()=>{De.current.multiple=!1,De.current.onchange=e=>He(e,"cover"),De.current.click()}}),(0,c.jsx)(T,{scheduledTime:q,onScheduledTimeChange:K,isFeatured:F,onIsFeaturedChange:A,isUpdating:!!a})]})]}),(0,c.jsx)(L,{content:w,onContentChange:C,editorRef:Me,onImageUploadBefore:(e,t,a)=>{const s=e[0];if(!s)return;je(()=>a);const l=new FileReader;return l.addEventListener("load",()=>{var e;return B({isOpen:!0,type:"suneditor",src:(null===(e=l.result)||void 0===e?void 0:e.toString())||""})}),l.readAsDataURL(s),!1},onLoad:()=>{Me.current&&w&&!Re.current&&(Re.current=!0)}})]})]})}},2224:(e,t,a)=>{var s={"./ckb.js":3743,"./cs.js":7333,"./da.js":1664,"./de.js":844,"./en.js":5460,"./es.js":6151,"./fa.js":6062,"./fr.js":7755,"./he.js":3296,"./hu.js":3776,"./index.js":559,"./it.js":4762,"./ja.js":74,"./km.js":7671,"./ko.js":665,"./lv.js":749,"./nl.js":6449,"./pl.js":8599,"./pt_br.js":8366,"./ro.js":3100,"./ru.js":4638,"./se.js":5111,"./tr.js":57,"./ua.js":9657,"./ur.js":4640,"./zh_cn.js":5277};function l(e){var t=n(e);return a(t)}function n(e){if(!a.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}l.keys=function(){return Object.keys(s)},l.resolve=n,e.exports=l,l.id=2224}}]);
//# sourceMappingURL=533.b56c9ce0.chunk.js.map