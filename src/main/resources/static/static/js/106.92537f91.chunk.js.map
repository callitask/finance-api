{"version":3,"file":"static/js/106.92537f91.chunk.js","mappings":"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","sources":["pages/AudiencePage.js"],"sourcesContent":["import React, { useEffect, useState, useMemo } from 'react';\r\nimport { getHistoricalAudienceData } from '../apiConfig';\r\nimport { FaCalendarAlt, FaMapMarkedAlt, FaMobileAlt, FaDesktop, FaClock, FaRedo, FaExclamationTriangle, FaChartBar, FaUser, FaGlobe, FaSearch, FaFilter } from 'react-icons/fa';\r\n\r\n// Helper component for table cell display\r\nconst DetailCell = ({ icon: Icon, value, label }) => (\r\n    <div className=\"flex items-center text-sm text-gray-700\">\r\n        <Icon className=\"text-sky-500 mr-2 flex-shrink-0\" title={label} />\r\n        <span className=\"truncate\" title={value || 'N/A'}>\r\n            {value || 'N/A'}\r\n        </span>\r\n    </div>\r\n);\r\n\r\n// Function to format today's date in YYYY-MM-DD format\r\nconst getTodayDateString = () => {\r\n    return new Date().toISOString().split('T')[0];\r\n};\r\n\r\nconst AudiencePage = () => {\r\n    const [data, setData] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n    const [startDate, setStartDate] = useState(getTodayDateString());\r\n    const [endDate, setEndDate] = useState(getTodayDateString());\r\n    const [lastFetchTime, setLastFetchTime] = useState(null);\r\n\r\n    // NEW STATE for Filters\r\n    const [filterCountry, setFilterCountry] = useState('');\r\n    const [filterRegion, setFilterRegion] = useState('');\r\n    const [filterDeviceCategory, setFilterDeviceCategory] = useState('');\r\n    const [filterUserType, setFilterUserType] = useState('');\r\n    const [expandedRows, setExpandedRows] = useState({}); // For drill-down feature\r\n\r\n    const fetchData = async (start, end, country, region, device, userType) => {\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        if (!start || !end || new Date(start) > new Date(end)) {\r\n            setError('Invalid date range. Start date must be before or equal to the end date.');\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await getHistoricalAudienceData(\r\n                start,\r\n                end,\r\n                country || null,\r\n                region || null,\r\n                device || null,\r\n                userType || null\r\n            );\r\n            setData(response.data);\r\n            setLastFetchTime(new Date());\r\n        } catch (err) {\r\n            console.error('Error fetching audience data:', err);\r\n            if (err.response && (err.response.status === 403 || err.response.status === 401)) {\r\n                setError('Access Denied. You do not have permission to view this data.');\r\n            } else {\r\n                setError('Failed to fetch historical audience data. Check backend logs and GA4 setup. If your dashboard shows \"GA4 Restricted\" after restarting the server, ensure you deleted the old data from MariaDB.');\r\n            }\r\n            setData([]);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // Initial fetch when component mounts: loads last 7 days of data\r\n    useEffect(() => {\r\n        const today = new Date();\r\n        const defaultStart = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];\r\n        setStartDate(defaultStart);\r\n        fetchData(defaultStart, getTodayDateString(), null, null, null, null);\r\n    }, []);\r\n\r\n    const handleDateChange = (e, type) => {\r\n        const value = e.target.value;\r\n        if (type === 'start') {\r\n            setStartDate(value);\r\n        } else {\r\n            setEndDate(value);\r\n        }\r\n    };\r\n\r\n    const handleSearchClick = () => {\r\n        setExpandedRows({}); // Collapse all on new search\r\n        fetchData(startDate, endDate, filterCountry, filterRegion, filterDeviceCategory, filterUserType);\r\n    };\r\n\r\n    const toggleRowExpansion = (id) => {\r\n        setExpandedRows(prev => ({\r\n            ...prev,\r\n            [id]: !prev[id]\r\n        }));\r\n    };\r\n\r\n\r\n    // --- Dynamic Filter Data Calculation ---\r\n    // Extract unique filter values from the currently displayed data\r\n    const uniqueFilterOptions = useMemo(() => {\r\n        const countries = new Set();\r\n        const regions = new Set();\r\n        const devices = new Set();\r\n        const userTypes = new Set();\r\n\r\n        data.forEach(item => {\r\n            if (item.country) countries.add(item.country);\r\n            if (item.region) regions.add(item.region);\r\n            if (item.deviceCategory) devices.add(item.deviceCategory);\r\n            if (item.userType) userTypes.add(item.userType);\r\n        });\r\n\r\n        return {\r\n            countries: Array.from(countries).sort(),\r\n            regions: Array.from(regions).sort(),\r\n            devices: Array.from(devices).sort(),\r\n            userTypes: Array.from(userTypes).sort(),\r\n        };\r\n    }, [data]);\r\n\r\n    // --- Render Logic (Same as before) ---\r\n    const columns = [\r\n        {\r\n            key: 'expand',\r\n            title: '',\r\n            render: (item) => (\r\n                <button onClick={() => toggleRowExpansion(item.id)} className=\"text-gray-500 hover:text-sky-600 transition-colors\">\r\n                    {expandedRows[item.id] ? '▲' : '▼'}\r\n                </button>\r\n            )\r\n        },\r\n        {\r\n            key: 'sessionDate',\r\n            title: 'Date',\r\n            render: (item) => (\r\n                <div className=\"space-y-1\">\r\n                    <DetailCell icon={FaCalendarAlt} value={item.sessionDate} label=\"Session Date\" />\r\n                    <p className=\"text-xs text-gray-500 font-semibold\">\r\n                        <FaUser className=\"inline mr-1\" /> {item.userType}\r\n                    </p>\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            key: 'location',\r\n            title: 'Location (City, Region, Country)',\r\n            render: (item) => (\r\n                <DetailCell\r\n                    icon={FaMapMarkedAlt}\r\n                    value={`${item.city || 'N/A'}, ${item.region || 'N/A'}, ${item.country || 'N/A'}`}\r\n                    label=\"Location\"\r\n                />\r\n            )\r\n        },\r\n        {\r\n            key: 'device',\r\n            title: 'Device & OS',\r\n            render: (item) => (\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-700 font-semibold\">\r\n                        <FaMobileAlt className=\"inline mr-1 text-sky-500\" /> {item.deviceCategory} ({item.deviceModel || 'N/A'})\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        <FaGlobe className=\"inline mr-1 text-sky-500\" /> {item.operatingSystem} ({item.osVersion || 'N/A'})\r\n                    </p>\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            key: 'traffic',\r\n            title: 'Source & Landing Page',\r\n            render: (item) => (\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-700 font-semibold\">Source: {item.sessionSource}</p>\r\n                    <p className=\"text-xs text-gray-500 truncate max-w-xs\" title={item.landingPage}>Landing: {item.landingPage}</p>\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            key: 'time',\r\n            title: 'Metrics',\r\n            render: (item) => (\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-700 font-semibold\">\r\n                        <FaClock className=\"inline mr-1 text-sky-500\" /> Avg. Time: {item.timeOnSiteFormatted}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        <FaChartBar className=\"inline mr-1 text-sky-500\" /> Sessions: {item.views}\r\n                    </p>\r\n                </div>\r\n            )\r\n        }\r\n    ];\r\n\r\n    return (\r\n        <div className=\"container mx-auto p-6 md:p-8\">\r\n            <h1 className=\"text-3xl font-bold text-gray-800 mb-4\">Historical Audience Report</h1>\r\n            <p className=\"text-gray-600 mb-6\">Detailed visitor logs stored in the database. Data is synchronized daily from Google Analytics (GA4).</p>\r\n\r\n            <div className=\"bg-white p-4 rounded-lg shadow-sm mb-6 flex flex-col space-y-4\">\r\n                {/* Row 1: Date Range and Search Button */}\r\n                <div className=\"flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4\">\r\n                    <div className=\"flex items-center space-x-2 w-full md:w-auto\">\r\n                        <label htmlFor=\"startDate\" className=\"text-sm font-medium text-gray-700 flex-shrink-0\">From:</label>\r\n                        <input\r\n                            type=\"date\"\r\n                            id=\"startDate\"\r\n                            value={startDate}\r\n                            onChange={(e) => handleDateChange(e, 'start')}\r\n                            className=\"p-2 border border-gray-300 rounded-lg w-full text-sm\"\r\n                            disabled={loading}\r\n                        />\r\n                    </div>\r\n                    <div className=\"flex items-center space-x-2 w-full md:w-auto\">\r\n                        <label htmlFor=\"endDate\" className=\"text-sm font-medium text-gray-700 flex-shrink-0\">To:</label>\r\n                        <input\r\n                            type=\"date\"\r\n                            id=\"endDate\"\r\n                            value={endDate}\r\n                            onChange={(e) => handleDateChange(e, 'end')}\r\n                            className=\"p-2 border border-gray-300 rounded-lg w-full text-sm\"\r\n                            disabled={loading}\r\n                        />\r\n                    </div>\r\n                    <button\r\n                        onClick={handleSearchClick}\r\n                        disabled={loading}\r\n                        className={`flex items-center px-4 py-2 text-sm rounded-lg transition duration-300 w-full md:w-auto justify-center ${loading\r\n                            ? 'bg-gray-300 text-gray-600 cursor-not-allowed'\r\n                            : 'bg-sky-600 text-white hover:bg-sky-700'\r\n                            }`}\r\n                    >\r\n                        <FaSearch className={`mr-2 ${loading ? 'animate-pulse' : ''}`} />\r\n                        {loading ? 'Fetching...' : 'Apply Filters'}\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Row 2: Multi-Level Filters */}\r\n                <div className=\"border-t border-gray-200 pt-4 flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4\">\r\n                    <FaFilter className=\"text-gray-500 flex-shrink-0 hidden md:block\" title=\"Filters\" />\r\n\r\n                    {/* User Type Filter (New/Returning) */}\r\n                    <select\r\n                        value={filterUserType}\r\n                        onChange={(e) => setFilterUserType(e.target.value)}\r\n                        className=\"p-2 border border-gray-300 rounded-lg w-full md:w-auto text-sm\"\r\n                        disabled={loading}\r\n                    >\r\n                        <option value=\"\">Filter by User Type</option>\r\n                        {uniqueFilterOptions.userTypes.map(userType => (\r\n                            <option key={userType} value={userType}>{userType}</option>\r\n                        ))}\r\n                    </select>\r\n\r\n                    {/* Country Filter */}\r\n                    <select\r\n                        value={filterCountry}\r\n                        onChange={(e) => {\r\n                            setFilterCountry(e.target.value);\r\n                            setFilterRegion(''); // Clear region for cascaded filtering\r\n                        }}\r\n                        className=\"p-2 border border-gray-300 rounded-lg w-full md:w-auto text-sm\"\r\n                        disabled={loading}\r\n                    >\r\n                        <option value=\"\">Filter by Country</option>\r\n                        {uniqueFilterOptions.countries.map(country => (\r\n                            <option key={country} value={country}>{country}</option>\r\n                        ))}\r\n                    </select>\r\n\r\n                    {/* Region Filter */}\r\n                    <select\r\n                        value={filterRegion}\r\n                        onChange={(e) => setFilterRegion(e.target.value)}\r\n                        className=\"p-2 border border-gray-300 rounded-lg w-full md:w-auto text-sm\"\r\n                        disabled={loading}\r\n                    >\r\n                        <option value=\"\">Filter by Region</option>\r\n                        {uniqueFilterOptions.regions.map(region => (\r\n                            <option key={region} value={region}>{region}</option>\r\n                        ))}\r\n                    </select>\r\n\r\n                    {/* Device Category Filter */}\r\n                    <select\r\n                        value={filterDeviceCategory}\r\n                        onChange={(e) => setFilterDeviceCategory(e.target.value)}\r\n                        className=\"p-2 border border-gray-300 rounded-lg w-full md:w-auto text-sm\"\r\n                        disabled={loading}\r\n                    >\r\n                        <option value=\"\">Filter by Device</option>\r\n                        {uniqueFilterOptions.devices.map(device => (\r\n                            <option key={device} value={device}>{device}</option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white rounded-lg shadow-lg overflow-x-auto\">\r\n                {error && (\r\n                    <div className=\"p-4 bg-red-100 text-red-700 border-l-4 border-red-500 flex items-center\">\r\n                        <FaExclamationTriangle className=\"mr-3 flex-shrink-0 text-xl\" />\r\n                        <div>\r\n                            <p className=\"font-semibold\">{error}</p>\r\n                            <p className=\"text-sm\">Please check the date range and ensure the scheduled job is running successfully to import new data. **If you still see \"GA4 Restricted,\" you must manually run the MariaDB command above to clear the old records and restart the server.**</p>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {loading && data.length === 0 ? (\r\n                    <div className=\"p-6 text-center text-gray-500\">\r\n                        <FaRedo className=\"mx-auto text-3xl mb-2 animate-spin\" />\r\n                        <p>Loading historical report for selected dates...</p>\r\n                    </div>\r\n                ) : (\r\n                    <table className=\"min-w-full divide-y divide-gray-200\">\r\n                        <thead className=\"bg-gray-50\">\r\n                            <tr>\r\n                                {columns.map(col => (\r\n                                    <th\r\n                                        key={col.key}\r\n                                        className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap\"\r\n                                    >\r\n                                        {col.title}\r\n                                    </th>\r\n                                ))}\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                            {data.length > 0 ? (\r\n                                data.map((item, index) => (\r\n                                    <React.Fragment key={item.id || index}>\r\n                                        <tr className=\"hover:bg-sky-50/50\">\r\n                                            {columns.map(col => (\r\n                                                <td key={col.key} className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                    {col.render(item)}\r\n                                                </td>\r\n                                            ))}\r\n                                        </tr>\r\n                                        {expandedRows[item.id] && (\r\n                                            <tr className=\"bg-gray-100/50\">\r\n                                                <td colSpan={columns.length} className=\"px-6 py-3 text-sm text-gray-700\">\r\n                                                    <div className=\"font-semibold mb-2\">Detailed Session Information (Drill-Down)</div>\r\n                                                    <div className=\"grid grid-cols-2 gap-x-4 gap-y-2\">\r\n                                                        <div><span className=\"font-medium\">User Identifier (Client ID):</span> {item.userIdentifier}</div>\r\n                                                        <div><span className=\"font-medium\">Raw Session ID:</span> {item.rawSessionId}</div>\r\n                                                        <div><span className=\"font-medium\">OS Version:</span> {item.operatingSystem} {item.osVersion}</div>\r\n                                                        <div><span className=\"font-medium\">Screen Resolution:</span> {item.screenResolution}</div>\r\n                                                    </div>\r\n                                                </td>\r\n                                            </tr>\r\n                                        )}\r\n                                    </React.Fragment>\r\n                                ))\r\n                            ) : (\r\n                                !error && (\r\n                                    <tr>\r\n                                        <td colSpan={columns.length} className=\"px-6 py-12 text-center text-gray-500\">\r\n                                            <FaChartBar className=\"mx-auto text-4xl mb-4 text-gray-400\" />\r\n                                            <p className=\"text-lg font-semibold\">No visitor data found for the selected date range.</p>\r\n                                        </td>\r\n                                    </tr>\r\n                                )\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AudiencePage;"],"names":["DetailCell","_ref","icon","Icon","value","label","_jsxs","className","children","_jsx","title","getTodayDateString","Date","toISOString","split","AudiencePage","data","setData","useState","loading","setLoading","error","setError","startDate","setStartDate","endDate","setEndDate","lastFetchTime","setLastFetchTime","filterCountry","setFilterCountry","filterRegion","setFilterRegion","filterDeviceCategory","setFilterDeviceCategory","filterUserType","setFilterUserType","expandedRows","setExpandedRows","fetchData","async","start","end","country","region","device","userType","response","getHistoricalAudienceData","err","console","status","useEffect","today","defaultStart","getTime","handleDateChange","e","type","target","uniqueFilterOptions","useMemo","countries","Set","regions","devices","userTypes","forEach","item","add","deviceCategory","Array","from","sort","columns","key","render","onClick","toggleRowExpansion","id","prev","_objectSpread","FaCalendarAlt","sessionDate","FaUser","FaMapMarkedAlt","concat","city","FaMobileAlt","deviceModel","FaGlobe","operatingSystem","osVersion","sessionSource","landingPage","FaClock","timeOnSiteFormatted","FaChartBar","views","htmlFor","onChange","disabled","handleSearchClick","FaSearch","FaFilter","map","FaExclamationTriangle","length","FaRedo","col","index","React","colSpan","userIdentifier","rawSessionId","screenResolution"],"sourceRoot":""}