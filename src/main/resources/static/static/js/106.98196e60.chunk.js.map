{"version":3,"file":"static/js/106.98196e60.chunk.js","mappings":"iNAKA,MAAMA,EAAaC,IAAA,IAAGC,KAAMC,EAAI,MAAEC,EAAK,MAAEC,GAAOJ,EAAA,OAC5CK,EAAAA,EAAAA,MAAA,OAAKC,UAAU,0CAAyCC,SAAA,EACpDC,EAAAA,EAAAA,KAACN,EAAI,CAACI,UAAU,kCAAkCG,MAAOL,KACzDI,EAAAA,EAAAA,KAAA,QAAMF,UAAU,WAAWG,MAAON,GAAS,MAAMI,SAC5CJ,GAAS,YAMhBO,EAAqBA,KAChB,IAAIC,MAAOC,cAAcC,MAAM,KAAK,GA4S/C,EAzSqBC,KACjB,MAAOC,EAAMC,IAAWC,EAAAA,EAAAA,UAAS,KAC1BC,EAASC,IAAcF,EAAAA,EAAAA,WAAS,IAChCG,EAAOC,IAAYJ,EAAAA,EAAAA,UAAS,KAC5BK,EAAWC,IAAgBN,EAAAA,EAAAA,UAASP,MACpCc,EAASC,IAAcR,EAAAA,EAAAA,UAASP,MAChCgB,EAAeC,IAAoBV,EAAAA,EAAAA,UAAS,OAG5CW,EAAeC,IAAoBZ,EAAAA,EAAAA,UAAS,KAC5Ca,EAAcC,IAAmBd,EAAAA,EAAAA,UAAS,KAC1Ce,EAAsBC,IAA2BhB,EAAAA,EAAAA,UAAS,IAE3DiB,EAAYC,MAAOC,EAAOC,EAAKC,EAASC,EAAQC,KAIlD,GAHArB,GAAW,GACXE,EAAS,KAEJe,IAAUC,GAAO,IAAI1B,KAAKyB,GAAS,IAAIzB,KAAK0B,GAG7C,OAFAhB,EAAS,gFACTF,GAAW,GAIf,IACI,MAAMsB,QAAiBC,EAAAA,EAAAA,IAA0BN,EAAOC,EAAKC,GAAW,KAAMC,GAAU,KAAMC,GAAU,MACxGxB,EAAQyB,EAAS1B,MACjBY,EAAiB,IAAIhB,KACzB,CAAE,MAAOgC,GACLC,QAAQxB,MAAM,gCAAiCuB,IAC3CA,EAAIF,UAAqC,MAAxBE,EAAIF,SAASI,QAA0C,MAAxBF,EAAIF,SAASI,OAG7DxB,EAAS,4IAFTA,EAAS,gEAIbL,EAAQ,GACZ,CAAC,QACGG,GAAW,EACf,IAIJ2B,EAAAA,EAAAA,WAAU,KACN,MAAMC,EAAQ,IAAIpC,KACZqC,EAAe,IAAIrC,KAAKoC,EAAME,UAAY,QAAyBrC,cAAcC,MAAM,KAAK,GAClGU,EAAayB,GACbd,EAAUc,EAActC,IAAsB,KAAM,KAAM,OAC3D,IAEH,MAAMwC,EAAmBA,CAACC,EAAGC,KACzB,MAAMjD,EAAQgD,EAAEE,OAAOlD,MACV,UAATiD,EACA7B,EAAapB,GAEbsB,EAAWtB,IAUbmD,GAAsBC,EAAAA,EAAAA,SAAQ,KAChC,MAAMC,EAAY,IAAIC,IAChBC,EAAU,IAAID,IACdE,EAAU,IAAIF,IAQpB,OANA1C,EAAK6C,QAAQC,IACLA,EAAKvB,SAASkB,EAAUM,IAAID,EAAKvB,SACjCuB,EAAKtB,QAAQmB,EAAQI,IAAID,EAAKtB,QAC9BsB,EAAKE,gBAAgBJ,EAAQG,IAAID,EAAKE,kBAGvC,CACHP,UAAWQ,MAAMC,KAAKT,GAAWU,OACjCR,QAASM,MAAMC,KAAKP,GAASQ,OAC7BP,QAASK,MAAMC,KAAKN,GAASO,SAElC,CAACnD,IAGEoD,EAAU,CACZ,CACIC,IAAK,cACL3D,MAAO,OACP4D,OAASR,IAASrD,EAAAA,EAAAA,KAACT,EAAU,CAACE,KAAMqE,EAAAA,IAAenE,MAAO0D,EAAKU,YAAanE,MAAM,kBAEtF,CACIgE,IAAK,WACL3D,MAAO,mCACP4D,OAASR,IACLrD,EAAAA,EAAAA,KAACT,EAAU,CACPE,KAAMuE,EAAAA,IACNrE,MAAK,GAAAsE,OAAKZ,EAAKa,MAAQ,MAAK,MAAAD,OAAKZ,EAAKtB,QAAU,MAAK,MAAAkC,OAAKZ,EAAKvB,SAAW,OAC1ElC,MAAM,cAIlB,CACIgE,IAAK,SACL3D,MAAO,cACP4D,OAASR,IACLxD,EAAAA,EAAAA,MAAA,OAAKC,UAAU,YAAWC,SAAA,EAEtBF,EAAAA,EAAAA,MAAA,KAAGC,UAAU,sCAAqCC,SAAA,EAC9CC,EAAAA,EAAAA,KAACmE,EAAAA,IAAW,CAACrE,UAAU,6BAA6B,IAAEuD,EAAKE,eAAe,KAAGF,EAAKe,aAAe,MAAM,QAE3GvE,EAAAA,EAAAA,MAAA,KAAGC,UAAU,wBAAuBC,SAAA,EAChCC,EAAAA,EAAAA,KAACqE,EAAAA,IAAO,CAACvE,UAAU,6BAA6B,IAAEuD,EAAKiB,gBAAgB,KAAGjB,EAAKkB,WAAa,MAAM,QAEtG1E,EAAAA,EAAAA,MAAA,KAAGC,UAAU,wBAAuBC,SAAA,EAChCC,EAAAA,EAAAA,KAACwE,EAAAA,IAAS,CAAC1E,UAAU,6BAA6B,gBAAcuD,EAAKoB,kBAAoB,aAKzG,CACIb,IAAK,UACL3D,MAAO,wBACP4D,OAASR,IACLxD,EAAAA,EAAAA,MAAA,OAAKC,UAAU,YAAWC,SAAA,EACtBF,EAAAA,EAAAA,MAAA,KAAGC,UAAU,sCAAqCC,SAAA,CAAC,WAASsD,EAAKqB,kBACjE7E,EAAAA,EAAAA,MAAA,KAAGC,UAAU,0CAA0CG,MAAOoD,EAAKsB,YAAY5E,SAAA,CAAC,YAAUsD,EAAKsB,mBAI3G,CACIf,IAAK,OACL3D,MAAO,eACP4D,OAASR,IACLxD,EAAAA,EAAAA,MAAA,OAAKC,UAAU,YAAWC,SAAA,EACtBF,EAAAA,EAAAA,MAAA,KAAGC,UAAU,sCAAqCC,SAAA,EAC9CC,EAAAA,EAAAA,KAAC4E,EAAAA,IAAO,CAAC9E,UAAU,6BAA6B,IAAEuD,EAAKwB,wBAE3DhF,EAAAA,EAAAA,MAAA,KAAGC,UAAU,wBAAuBC,SAAA,EAChCC,EAAAA,EAAAA,KAAC8E,EAAAA,IAAU,CAAChF,UAAU,6BAA6B,cAAYuD,EAAK0B,UAExElF,EAAAA,EAAAA,MAAA,KAAGC,UAAU,wBAAuBC,SAAA,EAEhCC,EAAAA,EAAAA,KAACgF,EAAAA,IAAM,CAAClF,UAAU,6BAA6B,UAAQuD,EAAK4B,eAAiB5B,EAAK4B,eAAeC,UAAU,EAAG,GAAK,MAAQ,cAO/I,OACIrF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,+BAA8BC,SAAA,EACzCC,EAAAA,EAAAA,KAAA,MAAIF,UAAU,wCAAuCC,SAAC,gCACtDC,EAAAA,EAAAA,KAAA,KAAGF,UAAU,qBAAoBC,SAAC,2GAElCF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,iEAAgEC,SAAA,EAC3EF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,6EAA4EC,SAAA,EAEvFF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,+CAA8CC,SAAA,EACzDC,EAAAA,EAAAA,KAAA,SAAOmF,QAAQ,YAAYrF,UAAU,kDAAiDC,SAAC,WACvFC,EAAAA,EAAAA,KAAA,SACI4C,KAAK,OACLwC,GAAG,YACHzF,MAAOmB,EACPuE,SAAW1C,GAAMD,EAAiBC,EAAG,SACrC7C,UAAU,uDACVwF,SAAU5E,QAGlBb,EAAAA,EAAAA,MAAA,OAAKC,UAAU,+CAA8CC,SAAA,EACzDC,EAAAA,EAAAA,KAAA,SAAOmF,QAAQ,UAAUrF,UAAU,kDAAiDC,SAAC,SACrFC,EAAAA,EAAAA,KAAA,SACI4C,KAAK,OACLwC,GAAG,UACHzF,MAAOqB,EACPqE,SAAW1C,GAAMD,EAAiBC,EAAG,OACrC7C,UAAU,uDACVwF,SAAU5E,WAMtBb,EAAAA,EAAAA,MAAA,OAAKC,UAAU,2GAA0GC,SAAA,EACrHC,EAAAA,EAAAA,KAACuF,EAAAA,IAAQ,CAACzF,UAAU,8CAA8CG,MAAM,aAGxEJ,EAAAA,EAAAA,MAAA,UACIF,MAAOyB,EACPiE,SAAW1C,GAAMtB,EAAiBsB,EAAEE,OAAOlD,OAC3CG,UAAU,iEACVwF,SAAU5E,EAAQX,SAAA,EAElBC,EAAAA,EAAAA,KAAA,UAAQL,MAAM,GAAEI,SAAC,sBAChB+C,EAAoBE,UAAUwC,IAAI1D,IAC/B9B,EAAAA,EAAAA,KAAA,UAAsBL,MAAOmC,EAAQ/B,SAAE+B,GAA1BA,QAKrBjC,EAAAA,EAAAA,MAAA,UACIF,MAAO2B,EACP+D,SAAW1C,GAAMpB,EAAgBoB,EAAEE,OAAOlD,OAC1CG,UAAU,iEACVwF,SAAU5E,IAAYU,EAAerB,SAAA,EAErCC,EAAAA,EAAAA,KAAA,UAAQL,MAAM,GAAEI,SAAC,uCAChB+C,EAAoBI,QAAQsC,IAAIzD,IAC7B/B,EAAAA,EAAAA,KAAA,UAAqBL,MAAOoC,EAAOhC,SAAEgC,GAAxBA,QAKrBlC,EAAAA,EAAAA,MAAA,UACIF,MAAO6B,EACP6D,SAAW1C,GAAMlB,EAAwBkB,EAAEE,OAAOlD,OAClDG,UAAU,iEACVwF,SAAU5E,EAAQX,SAAA,EAElBC,EAAAA,EAAAA,KAAA,UAAQL,MAAM,GAAEI,SAAC,qBAChB+C,EAAoBK,QAAQqC,IAAIxD,IAC7BhC,EAAAA,EAAAA,KAAA,UAAqBL,MAAOqC,EAAOjC,SAAEiC,GAAxBA,QAIrBnC,EAAAA,EAAAA,MAAA,UACI4F,QAtKMC,KACtBhE,EAAUZ,EAAWE,EAASI,EAAeE,EAAcE,IAsK3C8D,SAAU5E,EACVZ,UAAS,0GAAAmE,OAA4GvD,EAC/G,+CACA,0CACCX,SAAA,EAEPC,EAAAA,EAAAA,KAAC2F,EAAAA,IAAQ,CAAC7F,UAAS,QAAAmE,OAAUvD,EAAU,gBAAkB,MACxDA,EAAU,cAAgB,0BAMvCb,EAAAA,EAAAA,MAAA,OAAKC,UAAU,gDAA+CC,SAAA,CACzDa,IACGf,EAAAA,EAAAA,MAAA,OAAKC,UAAU,0EAAyEC,SAAA,EACpFC,EAAAA,EAAAA,KAAC4F,EAAAA,IAAqB,CAAC9F,UAAU,gCACjCD,EAAAA,EAAAA,MAAA,OAAAE,SAAA,EACIC,EAAAA,EAAAA,KAAA,KAAGF,UAAU,gBAAeC,SAAEa,KAC9BZ,EAAAA,EAAAA,KAAA,KAAGF,UAAU,UAASC,SAAC,+GAKlCW,GAA2B,IAAhBH,EAAKsF,QACbhG,EAAAA,EAAAA,MAAA,OAAKC,UAAU,gCAA+BC,SAAA,EAC1CC,EAAAA,EAAAA,KAAC8F,EAAAA,IAAM,CAAChG,UAAU,wCAClBE,EAAAA,EAAAA,KAAA,KAAAD,SAAG,wDAGPF,EAAAA,EAAAA,MAAA,SAAOC,UAAU,sCAAqCC,SAAA,EAClDC,EAAAA,EAAAA,KAAA,SAAOF,UAAU,aAAYC,UACzBC,EAAAA,EAAAA,KAAA,MAAAD,SACK4D,EAAQ6B,IAAIO,IACT/F,EAAAA,EAAAA,KAAA,MAEIF,UAAU,mGAAkGC,SAE3GgG,EAAI9F,OAHA8F,EAAInC,WAQzB5D,EAAAA,EAAAA,KAAA,SAAOF,UAAU,oCAAmCC,SAC/CQ,EAAKsF,OAAS,EACXtF,EAAKiF,IAAI,CAACnC,EAAM2C,KACZhG,EAAAA,EAAAA,KAAA,MAA2BF,UAAU,qBAAoBC,SACpD4D,EAAQ6B,IAAIO,IACT/F,EAAAA,EAAAA,KAAA,MAAkBF,UAAU,8BAA6BC,SACpDgG,EAAIlC,OAAOR,IADP0C,EAAInC,OAFZP,EAAK+B,IAAMY,KASvBpF,IACGZ,EAAAA,EAAAA,KAAA,MAAAD,UACIF,EAAAA,EAAAA,MAAA,MAAIoG,QAAStC,EAAQkC,OAAQ/F,UAAU,uCAAsCC,SAAA,EACzEC,EAAAA,EAAAA,KAAC8E,EAAAA,IAAU,CAAChF,UAAU,yCACtBE,EAAAA,EAAAA,KAAA,KAAGF,UAAU,wBAAuBC,SAAC,wDACrCC,EAAAA,EAAAA,KAAA,KAAGF,UAAU,UAASC,SAAC,uI","sources":["pages/AudiencePage.js"],"sourcesContent":["import React, { useEffect, useState, useMemo } from 'react';\r\nimport { getHistoricalAudienceData } from '../apiConfig';\r\nimport { FaCalendarAlt, FaMapMarkedAlt, FaMobileAlt, FaDesktop, FaClock, FaRedo, FaExclamationTriangle, FaChartBar, FaUser, FaGlobe, FaSearch, FaFilter } from 'react-icons/fa';\r\n\r\n// Helper component for table cell display\r\nconst DetailCell = ({ icon: Icon, value, label }) => (\r\n    <div className=\"flex items-center text-sm text-gray-700\">\r\n        <Icon className=\"text-sky-500 mr-2 flex-shrink-0\" title={label} />\r\n        <span className=\"truncate\" title={value || 'N/A'}>\r\n            {value || 'N/A'}\r\n        </span>\r\n    </div>\r\n);\r\n\r\n// Function to format today's date in YYYY-MM-DD format\r\nconst getTodayDateString = () => {\r\n    return new Date().toISOString().split('T')[0];\r\n};\r\n\r\nconst AudiencePage = () => {\r\n    const [data, setData] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n    const [startDate, setStartDate] = useState(getTodayDateString());\r\n    const [endDate, setEndDate] = useState(getTodayDateString());\r\n    const [lastFetchTime, setLastFetchTime] = useState(null);\r\n\r\n    // NEW STATE for Filters\r\n    const [filterCountry, setFilterCountry] = useState('');\r\n    const [filterRegion, setFilterRegion] = useState('');\r\n    const [filterDeviceCategory, setFilterDeviceCategory] = useState('');\r\n\r\n    const fetchData = async (start, end, country, region, device) => {\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        if (!start || !end || new Date(start) > new Date(end)) {\r\n            setError('Invalid date range. Start date must be before or equal to the end date.');\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await getHistoricalAudienceData(start, end, country || null, region || null, device || null);\r\n            setData(response.data);\r\n            setLastFetchTime(new Date());\r\n        } catch (err) {\r\n            console.error('Error fetching audience data:', err);\r\n            if (err.response && (err.response.status === 403 || err.response.status === 401)) {\r\n                setError('Access Denied. You do not have permission to view this data.');\r\n            } else {\r\n                setError('Failed to fetch historical audience data. Check backend logs and GA4 setup. The last attempt to fetch historical data might have failed.');\r\n            }\r\n            setData([]);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // Initial fetch when component mounts: loads last 7 days of data\r\n    useEffect(() => {\r\n        const today = new Date();\r\n        const defaultStart = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];\r\n        setStartDate(defaultStart);\r\n        fetchData(defaultStart, getTodayDateString(), null, null, null);\r\n    }, []);\r\n\r\n    const handleDateChange = (e, type) => {\r\n        const value = e.target.value;\r\n        if (type === 'start') {\r\n            setStartDate(value);\r\n        } else {\r\n            setEndDate(value);\r\n        }\r\n    };\r\n\r\n    const handleSearchClick = () => {\r\n        fetchData(startDate, endDate, filterCountry, filterRegion, filterDeviceCategory);\r\n    };\r\n\r\n    // --- Dynamic Filter Data Calculation ---\r\n    // Use useMemo to extract unique filter values from the currently displayed data\r\n    const uniqueFilterOptions = useMemo(() => {\r\n        const countries = new Set();\r\n        const regions = new Set();\r\n        const devices = new Set();\r\n\r\n        data.forEach(item => {\r\n            if (item.country) countries.add(item.country);\r\n            if (item.region) regions.add(item.region);\r\n            if (item.deviceCategory) devices.add(item.deviceCategory);\r\n        });\r\n\r\n        return {\r\n            countries: Array.from(countries).sort(),\r\n            regions: Array.from(regions).sort(),\r\n            devices: Array.from(devices).sort(),\r\n        };\r\n    }, [data]);\r\n\r\n    // --- Render Logic (Same as before) ---\r\n    const columns = [\r\n        {\r\n            key: 'sessionDate',\r\n            title: 'Date',\r\n            render: (item) => <DetailCell icon={FaCalendarAlt} value={item.sessionDate} label=\"Session Date\" />\r\n        },\r\n        {\r\n            key: 'location',\r\n            title: 'Location (City, Region, Country)',\r\n            render: (item) => (\r\n                <DetailCell\r\n                    icon={FaMapMarkedAlt}\r\n                    value={`${item.city || 'N/A'}, ${item.region || 'N/A'}, ${item.country || 'N/A'}`}\r\n                    label=\"Location\"\r\n                />\r\n            )\r\n        },\r\n        {\r\n            key: 'device',\r\n            title: 'Device & OS',\r\n            render: (item) => (\r\n                <div className=\"space-y-1\">\r\n                    {/* UPDATED: Displays real data or 'GA4 Restricted' if API fails to provide it */}\r\n                    <p className=\"text-xs text-gray-700 font-semibold\">\r\n                        <FaMobileAlt className=\"inline mr-1 text-sky-500\" /> {item.deviceCategory} ({item.deviceModel || 'N/A'})\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        <FaGlobe className=\"inline mr-1 text-sky-500\" /> {item.operatingSystem} ({item.osVersion || 'N/A'})\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        <FaDesktop className=\"inline mr-1 text-sky-500\" /> Resolution: {item.screenResolution || 'N/A'}\r\n                    </p>\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            key: 'traffic',\r\n            title: 'Source & Landing Page',\r\n            render: (item) => (\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-700 font-semibold\">Source: {item.sessionSource}</p>\r\n                    <p className=\"text-xs text-gray-500 truncate max-w-xs\" title={item.landingPage}>Landing: {item.landingPage}</p>\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            key: 'time',\r\n            title: 'Time & Views',\r\n            render: (item) => (\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-700 font-semibold\">\r\n                        <FaClock className=\"inline mr-1 text-sky-500\" /> {item.timeOnSiteFormatted}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        <FaChartBar className=\"inline mr-1 text-sky-500\" /> Sessions: {item.views}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        {/* UPDATED: userIdentifier / rawSessionId will show real data or 'GA4 Restricted' */}\r\n                        <FaUser className=\"inline mr-1 text-sky-500\" /> User: {item.userIdentifier ? item.userIdentifier.substring(0, 8) + '...' : 'N/A'}\r\n                    </p>\r\n                </div>\r\n            )\r\n        }\r\n    ];\r\n\r\n    return (\r\n        <div className=\"container mx-auto p-6 md:p-8\">\r\n            <h1 className=\"text-3xl font-bold text-gray-800 mb-4\">Historical Audience Report</h1>\r\n            <p className=\"text-gray-600 mb-6\">Detailed visitor logs stored in the database. Data is synchronized daily from Google Analytics (GA4).</p>\r\n\r\n            <div className=\"bg-white p-4 rounded-lg shadow-sm mb-6 flex flex-col space-y-4\">\r\n                <div className=\"flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4\">\r\n                    {/* Date Range Filters (unchanged) */}\r\n                    <div className=\"flex items-center space-x-2 w-full md:w-auto\">\r\n                        <label htmlFor=\"startDate\" className=\"text-sm font-medium text-gray-700 flex-shrink-0\">From:</label>\r\n                        <input\r\n                            type=\"date\"\r\n                            id=\"startDate\"\r\n                            value={startDate}\r\n                            onChange={(e) => handleDateChange(e, 'start')}\r\n                            className=\"p-2 border border-gray-300 rounded-lg w-full text-sm\"\r\n                            disabled={loading}\r\n                        />\r\n                    </div>\r\n                    <div className=\"flex items-center space-x-2 w-full md:w-auto\">\r\n                        <label htmlFor=\"endDate\" className=\"text-sm font-medium text-gray-700 flex-shrink-0\">To:</label>\r\n                        <input\r\n                            type=\"date\"\r\n                            id=\"endDate\"\r\n                            value={endDate}\r\n                            onChange={(e) => handleDateChange(e, 'end')}\r\n                            className=\"p-2 border border-gray-300 rounded-lg w-full text-sm\"\r\n                            disabled={loading}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* NEW Multi-Level Filters */}\r\n                <div className=\"border-t border-gray-200 pt-4 flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4\">\r\n                    <FaFilter className=\"text-gray-500 flex-shrink-0 hidden md:block\" title=\"Filters\" />\r\n\r\n                    {/* Country Filter */}\r\n                    <select\r\n                        value={filterCountry}\r\n                        onChange={(e) => setFilterCountry(e.target.value)}\r\n                        className=\"p-2 border border-gray-300 rounded-lg w-full md:w-auto text-sm\"\r\n                        disabled={loading}\r\n                    >\r\n                        <option value=\"\">Filter by Country</option>\r\n                        {uniqueFilterOptions.countries.map(country => (\r\n                            <option key={country} value={country}>{country}</option>\r\n                        ))}\r\n                    </select>\r\n\r\n                    {/* Region Filter */}\r\n                    <select\r\n                        value={filterRegion}\r\n                        onChange={(e) => setFilterRegion(e.target.value)}\r\n                        className=\"p-2 border border-gray-300 rounded-lg w-full md:w-auto text-sm\"\r\n                        disabled={loading || !filterCountry} // Cascading: Disable if no country selected\r\n                    >\r\n                        <option value=\"\">Filter by Region (All for Country)</option>\r\n                        {uniqueFilterOptions.regions.map(region => (\r\n                            <option key={region} value={region}>{region}</option>\r\n                        ))}\r\n                    </select>\r\n\r\n                    {/* Device Category Filter */}\r\n                    <select\r\n                        value={filterDeviceCategory}\r\n                        onChange={(e) => setFilterDeviceCategory(e.target.value)}\r\n                        className=\"p-2 border border-gray-300 rounded-lg w-full md:w-auto text-sm\"\r\n                        disabled={loading}\r\n                    >\r\n                        <option value=\"\">Filter by Device</option>\r\n                        {uniqueFilterOptions.devices.map(device => (\r\n                            <option key={device} value={device}>{device}</option>\r\n                        ))}\r\n                    </select>\r\n\r\n                    <button\r\n                        onClick={handleSearchClick}\r\n                        disabled={loading}\r\n                        className={`flex items-center px-4 py-2 text-sm rounded-lg transition duration-300 w-full md:w-auto justify-center ${loading\r\n                            ? 'bg-gray-300 text-gray-600 cursor-not-allowed'\r\n                            : 'bg-sky-600 text-white hover:bg-sky-700'\r\n                            }`}\r\n                    >\r\n                        <FaSearch className={`mr-2 ${loading ? 'animate-pulse' : ''}`} />\r\n                        {loading ? 'Fetching...' : 'Apply Filters'}\r\n                    </button>\r\n                </div>\r\n\r\n            </div>\r\n\r\n            <div className=\"bg-white rounded-lg shadow-lg overflow-x-auto\">\r\n                {error && (\r\n                    <div className=\"p-4 bg-red-100 text-red-700 border-l-4 border-red-500 flex items-center\">\r\n                        <FaExclamationTriangle className=\"mr-3 flex-shrink-0 text-xl\" />\r\n                        <div>\r\n                            <p className=\"font-semibold\">{error}</p>\r\n                            <p className=\"text-sm\">Please check the date range and ensure the scheduled job is running successfully to import new data.</p>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {loading && data.length === 0 ? (\r\n                    <div className=\"p-6 text-center text-gray-500\">\r\n                        <FaRedo className=\"mx-auto text-3xl mb-2 animate-spin\" />\r\n                        <p>Loading historical report for selected dates...</p>\r\n                    </div>\r\n                ) : (\r\n                    <table className=\"min-w-full divide-y divide-gray-200\">\r\n                        <thead className=\"bg-gray-50\">\r\n                            <tr>\r\n                                {columns.map(col => (\r\n                                    <th\r\n                                        key={col.key}\r\n                                        className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap\"\r\n                                    >\r\n                                        {col.title}\r\n                                    </th>\r\n                                ))}\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                            {data.length > 0 ? (\r\n                                data.map((item, index) => (\r\n                                    <tr key={item.id || index} className=\"hover:bg-sky-50/50\">\r\n                                        {columns.map(col => (\r\n                                            <td key={col.key} className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                {col.render(item)}\r\n                                            </td>\r\n                                        ))}\r\n                                    </tr>\r\n                                ))\r\n                            ) : (\r\n                                !error && (\r\n                                    <tr>\r\n                                        <td colSpan={columns.length} className=\"px-6 py-12 text-center text-gray-500\">\r\n                                            <FaChartBar className=\"mx-auto text-4xl mb-4 text-gray-400\" />\r\n                                            <p className=\"text-lg font-semibold\">No visitor data found for the selected date range.</p>\r\n                                            <p className=\"text-sm\">If this is the first day after implementation, initial data might be pending synchronization. Check back tomorrow.</p>\r\n                                        </td>\r\n                                    </tr>\r\n                                )\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AudiencePage;"],"names":["DetailCell","_ref","icon","Icon","value","label","_jsxs","className","children","_jsx","title","getTodayDateString","Date","toISOString","split","AudiencePage","data","setData","useState","loading","setLoading","error","setError","startDate","setStartDate","endDate","setEndDate","lastFetchTime","setLastFetchTime","filterCountry","setFilterCountry","filterRegion","setFilterRegion","filterDeviceCategory","setFilterDeviceCategory","fetchData","async","start","end","country","region","device","response","getHistoricalAudienceData","err","console","status","useEffect","today","defaultStart","getTime","handleDateChange","e","type","target","uniqueFilterOptions","useMemo","countries","Set","regions","devices","forEach","item","add","deviceCategory","Array","from","sort","columns","key","render","FaCalendarAlt","sessionDate","FaMapMarkedAlt","concat","city","FaMobileAlt","deviceModel","FaGlobe","operatingSystem","osVersion","FaDesktop","screenResolution","sessionSource","landingPage","FaClock","timeOnSiteFormatted","FaChartBar","views","FaUser","userIdentifier","substring","htmlFor","id","onChange","disabled","FaFilter","map","onClick","handleSearchClick","FaSearch","FaExclamationTriangle","length","FaRedo","col","index","colSpan"],"sourceRoot":""}