"use strict";(self.webpackChunktreishvaam_finance_frontend=self.webpackChunktreishvaam_finance_frontend||[]).push([[106],{1106:(e,t,s)=>{s.r(t),s.d(t,{default:()=>x});var a=s(9379),r=s(5043),i=s(6355),l=s(184),n=s(579);const c=e=>{let{icon:t,value:s,label:a}=e;return(0,n.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[(0,n.jsx)(t,{className:"text-sky-500 mr-2 flex-shrink-0",title:a}),(0,n.jsx)("span",{className:"truncate",title:s||"N/A",children:s||"N/A"})]})},d={country:"Country",region:"Region",city:"City",deviceCategory:"Device Category",operatingSystem:"Operating System",osVersion:"OS Version",sessionSource:"Session Source"},o={country:["region","city"],region:["city"],operatingSystem:["osVersion"]},x=()=>{const[e,t]=(0,r.useState)([]),[s,x]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),[p,h]=(0,r.useState)(""),[g,y]=(0,r.useState)(new Date((new Date).getTime()-6048e5).toISOString().split("T")[0]),[j,v]=(0,r.useState)((new Date).toISOString().split("T")[0]),[N,f]=(0,r.useState)([]),[b,w]=(0,r.useState)(null),S=(0,r.useCallback)(()=>{const e={startDate:g,endDate:j};return N.forEach(t=>{t.type&&t.value&&(e[t.type]=t.value)}),e},[g,j,N]);(0,r.useEffect)(()=>{(async()=>{x(!0),u(!0),h("");const e=S();try{const[s,a]=await Promise.all([(0,i.XF)(e),(0,i.vv)(e)]);w(s.data),t(a.data)}catch(s){console.error("Error fetching audience data or options:",s),!s.response||403!==s.response.status&&401!==s.response.status?h("Failed to fetch historical audience data. Check backend logs and GA4 setup."):h("Access Denied. You do not have permission to view this data."),t([]),w(null)}finally{x(!1),u(!1)}})()},[g,j,N,S]);const k=(e,t,s)=>{f(r=>{const i=[...r],l=i.findIndex(t=>t.id===e);if(-1===l)return r;const n=i[l];i[l]=(0,a.A)((0,a.A)({},n),{},{[t]:s}),"type"===t&&(i[l].value="");const c=o[n.type];return"value"===t&&c?i.map(e=>c.includes(e.type)?(0,a.A)((0,a.A)({},e),{},{value:""}):e):i})},C=[{key:"sessionDate",title:"Date",render:e=>(0,n.jsx)(c,{icon:l.bfZ,value:e.sessionDate,label:"Session Date"})},{key:"location",title:"Location (City, Region, Country)",render:e=>(0,n.jsx)(c,{icon:l.ZYm,value:"".concat(e.city||"N/A",", ").concat(e.region||"N/A",", ").concat(e.country||"N/A"),label:"Location"})},{key:"device",title:"Device & OS",render:e=>(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("p",{className:"text-xs text-gray-700 font-semibold",children:[(0,n.jsx)(l.rle,{className:"inline mr-1 text-sky-500"})," ",e.deviceCategory," (",e.deviceModel||"N/A",")"]}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,n.jsx)(l.f35,{className:"inline mr-1 text-sky-500"})," ",e.operatingSystem," (",e.osVersion||"N/A",")"]}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,n.jsx)(l.Wqt,{className:"inline mr-1 text-sky-500"})," Resolution: ",e.screenResolution||"N/A"]})]})},{key:"traffic",title:"Source & Landing Page",render:e=>(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("p",{className:"text-xs text-gray-700 font-semibold",children:["Source: ",e.sessionSource]}),(0,n.jsxs)("p",{className:"text-xs text-gray-500 truncate max-w-xs",title:e.landingPage,children:["Landing: ",e.landingPage]})]})},{key:"time",title:"Time & Views",render:e=>(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("p",{className:"text-xs text-gray-700 font-semibold",children:[(0,n.jsx)(l.w_X,{className:"inline mr-1 text-sky-500"})," ",e.timeOnSiteFormatted]}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,n.jsx)(l.v$b,{className:"inline mr-1 text-sky-500"})," Sessions: ",e.views]}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,n.jsx)(l.x$1,{className:"inline mr-1 text-sky-500"})," ID: ",e.userIdentifier?e.userIdentifier.substring(0,8)+"...":"N/A"]})]})}],A=e=>{if(!b)return[];switch(e){case"country":return b.countries||[];case"region":return b.regions||[];case"city":return b.cities||[];case"deviceCategory":return b.deviceCategories||[];case"operatingSystem":return b.operatingSystems||[];case"osVersion":return b.osVersions||[];case"sessionSource":return b.sessionSources||[];default:return[]}};return(0,n.jsxs)("div",{className:"container mx-auto p-6 md:p-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:"Historical Audience Report"}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:"Detailed visitor logs stored in the database. Data is synchronized daily from Google Analytics (GA4)."}),(0,n.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-4 flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 w-full md:w-auto",children:[(0,n.jsx)("label",{htmlFor:"startDate",className:"text-sm font-medium text-gray-700 flex-shrink-0",children:"From:"}),(0,n.jsx)("input",{type:"date",id:"startDate",value:g,onChange:e=>y(e.target.value),className:"p-2 border border-gray-300 rounded-lg w-full text-sm",disabled:s||m})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2 w-full md:w-auto",children:[(0,n.jsx)("label",{htmlFor:"endDate",className:"text-sm font-medium text-gray-700 flex-shrink-0",children:"To:"}),(0,n.jsx)("input",{type:"date",id:"endDate",value:j,onChange:e=>v(e.target.value),className:"p-2 border border-gray-300 rounded-lg w-full text-sm",disabled:s||m})]}),(0,n.jsxs)("div",{className:"text-sm text-gray-500 flex-grow",children:[(s||m)&&(0,n.jsx)(l.Swo,{className:"inline mr-2 animate-spin"}),s?"Fetching report data...":"",m&&!s?"Updating filter options...":""]})]}),(0,n.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-6 space-y-3",children:[(0,n.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Filters"}),0===N.length&&(0,n.jsx)("p",{className:"text-sm text-gray-500",children:'No filters applied. Click "Add Filter" to begin.'}),N.map(e=>(0,n.jsxs)("div",{className:"flex flex-col md:flex-row items-center space-y-2 md:space-y-0 md:space-x-2",children:[(0,n.jsxs)("select",{"aria-label":"Filter type",value:e.type,onChange:t=>k(e.id,"type",t.target.value),className:"p-2 border border-gray-300 rounded-lg w-full md:w-1/3 text-sm",disabled:s||m,children:[(0,n.jsx)("option",{value:"",children:"-- Select Filter Type --"}),Object.entries(d).map(e=>{let[t,s]=e;return(0,n.jsx)("option",{value:t,children:s},t)})]}),(0,n.jsxs)("select",{"aria-label":"Filter value",value:e.value,onChange:t=>k(e.id,"value",t.target.value),className:"p-2 border border-gray-300 rounded-lg w-full md:w-2/3 text-sm",disabled:!e.type||s||m,children:[(0,n.jsx)("option",{value:"",children:"-- Select Value --"}),A(e.type).map(e=>(0,n.jsx)("option",{value:e,children:e||"(Not Set)"},e))]}),(0,n.jsx)("button",{onClick:()=>{return t=e.id,void f(e=>e.filter(e=>e.id!==t));var t},className:"p-2 text-red-500 hover:text-red-700",title:"Remove filter",disabled:s||m,children:(0,n.jsx)(l.QCr,{})})]},e.id)),(0,n.jsxs)("button",{onClick:()=>{f(e=>[...e,{id:Date.now(),type:"",value:""}])},disabled:s||m,className:"flex items-center px-4 py-2 text-sm rounded-lg transition duration-300 bg-sky-600 text-white hover:bg-sky-700 disabled:bg-gray-300",children:[(0,n.jsx)(l.OiG,{className:"mr-2"}),"Add Filter"]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-x-auto",children:[p&&(0,n.jsxs)("div",{className:"p-4 bg-red-100 text-red-700 border-l-4 border-red-500 flex items-center",children:[(0,n.jsx)(l.BS8,{className:"mr-3 flex-shrink-0 text-xl"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-semibold",children:p}),(0,n.jsx)("p",{className:"text-sm",children:"Please check the date range and ensure the scheduled job is running successfully to import new data."})]})]}),s&&0===e.length?(0,n.jsxs)("div",{className:"p-6 text-center text-gray-500",children:[(0,n.jsx)(l.Swo,{className:"mx-auto text-3xl mb-2 animate-spin"}),(0,n.jsx)("p",{children:"Loading historical report for selected dates..."})]}):(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsx)("tr",{children:C.map(e=>(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:e.title},e.key))})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.length>0?e.map((e,t)=>(0,n.jsx)("tr",{className:"hover:bg-sky-50/50",children:C.map(t=>(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:t.render(e)},t.key))},e.id||t)):!p&&!s&&(0,n.jsx)("tr",{children:(0,n.jsxs)("td",{colSpan:C.length,className:"px-6 py-12 text-center text-gray-500",children:[(0,n.jsx)(l.v$b,{className:"mx-auto text-4xl mb-4 text-gray-400"}),(0,n.jsx)("p",{className:"text-lg font-semibold",children:"No visitor data found for the selected criteria."}),(0,n.jsx)("p",{className:"text-sm",children:"Try adjusting the date range or removing some filters."})]})})})]})]})]})}}}]);
//# sourceMappingURL=106.ae880d39.chunk.js.map