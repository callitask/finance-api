"use strict";(self.webpackChunktreishvaam_finance_frontend=self.webpackChunktreishvaam_finance_frontend||[]).push([[106],{1106:(e,s,t)=>{t.r(s),t.d(s,{default:()=>o});var a=t(9379),r=t(5043),l=t(6355),n=t(184),i=t(579);const d=e=>{let{icon:s,value:t,label:a}=e;return(0,i.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[(0,i.jsx)(s,{className:"text-sky-500 mr-2 flex-shrink-0",title:a}),(0,i.jsx)("span",{className:"truncate",title:t||"N/A",children:t||"N/A"})]})},c=()=>(new Date).toISOString().split("T")[0],o=()=>{const[e,s]=(0,r.useState)([]),[t,o]=(0,r.useState)(!1),[x,m]=(0,r.useState)(""),[u,h]=(0,r.useState)(c()),[y,g]=(0,r.useState)(c()),[p,j]=(0,r.useState)(null),[f,v]=(0,r.useState)(""),[b,N]=(0,r.useState)(""),[w,S]=(0,r.useState)(""),[k,D]=(0,r.useState)(""),[A,C]=(0,r.useState)({}),F=async(e,t,a,r,n,i)=>{if(o(!0),m(""),!e||!t||new Date(e)>new Date(t))return m("Invalid date range. Start date must be before or equal to the end date."),void o(!1);try{const d=await(0,l.vv)(e,t,a||null,r||null,n||null,i||null);s(d.data),j(new Date)}catch(d){console.error("Error fetching audience data:",d),!d.response||403!==d.response.status&&401!==d.response.status?m('Failed to fetch historical audience data. Check backend logs and GA4 setup. If your dashboard shows "GA4 Restricted" after restarting the server, ensure you deleted the old data from MariaDB.'):m("Access Denied. You do not have permission to view this data."),s([])}finally{o(!1)}};(0,r.useEffect)(()=>{const e=new Date,s=new Date(e.getTime()-6048e5).toISOString().split("T")[0];h(s),F(s,c(),null,null,null,null)},[]);const I=(e,s)=>{const t=e.target.value;"start"===s?h(t):g(t)},T=(0,r.useMemo)(()=>{const s=new Set,t=new Set,a=new Set,r=new Set;return e.forEach(e=>{e.country&&s.add(e.country),e.region&&t.add(e.region),e.deviceCategory&&a.add(e.deviceCategory),e.userType&&r.add(e.userType)}),{countries:Array.from(s).sort(),regions:Array.from(t).sort(),devices:Array.from(a).sort(),userTypes:Array.from(r).sort()}},[e]),R=[{key:"expand",title:"",render:e=>(0,i.jsx)("button",{onClick:()=>{return s=e.id,void C(e=>(0,a.A)((0,a.A)({},e),{},{[s]:!e[s]}));var s},className:"text-gray-500 hover:text-sky-600 transition-colors",children:A[e.id]?"\u25b2":"\u25bc"})},{key:"sessionDate",title:"Date",render:e=>(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(d,{icon:n.bfZ,value:e.sessionDate,label:"Session Date"}),(0,i.jsxs)("p",{className:"text-xs text-gray-500 font-semibold",children:[(0,i.jsx)(n.x$1,{className:"inline mr-1"})," ",e.userType]})]})},{key:"location",title:"Location (City, Region, Country)",render:e=>(0,i.jsx)(d,{icon:n.ZYm,value:"".concat(e.city||"N/A",", ").concat(e.region||"N/A",", ").concat(e.country||"N/A"),label:"Location"})},{key:"device",title:"Device & OS",render:e=>(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("p",{className:"text-xs text-gray-700 font-semibold",children:[(0,i.jsx)(n.rle,{className:"inline mr-1 text-sky-500"})," ",e.deviceCategory," (",e.deviceModel||"N/A",")"]}),(0,i.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,i.jsx)(n.f35,{className:"inline mr-1 text-sky-500"})," ",e.operatingSystem," (",e.osVersion||"N/A",")"]})]})},{key:"traffic",title:"Source & Landing Page",render:e=>(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("p",{className:"text-xs text-gray-700 font-semibold",children:["Source: ",e.sessionSource]}),(0,i.jsxs)("p",{className:"text-xs text-gray-500 truncate max-w-xs",title:e.landingPage,children:["Landing: ",e.landingPage]})]})},{key:"time",title:"Metrics",render:e=>(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("p",{className:"text-xs text-gray-700 font-semibold",children:[(0,i.jsx)(n.w_X,{className:"inline mr-1 text-sky-500"})," Avg. Time: ",e.timeOnSiteFormatted]}),(0,i.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,i.jsx)(n.v$b,{className:"inline mr-1 text-sky-500"})," Sessions: ",e.views]})]})}];return(0,i.jsxs)("div",{className:"container mx-auto p-6 md:p-8",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:"Historical Audience Report"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:"Detailed visitor logs stored in the database. Data is synchronized daily from Google Analytics (GA4)."}),(0,i.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-6 flex flex-col space-y-4",children:[(0,i.jsxs)("div",{className:"flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2 w-full md:w-auto",children:[(0,i.jsx)("label",{htmlFor:"startDate",className:"text-sm font-medium text-gray-700 flex-shrink-0",children:"From:"}),(0,i.jsx)("input",{type:"date",id:"startDate",value:u,onChange:e=>I(e,"start"),className:"p-2 border border-gray-300 rounded-lg w-full text-sm",disabled:t})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2 w-full md:w-auto",children:[(0,i.jsx)("label",{htmlFor:"endDate",className:"text-sm font-medium text-gray-700 flex-shrink-0",children:"To:"}),(0,i.jsx)("input",{type:"date",id:"endDate",value:y,onChange:e=>I(e,"end"),className:"p-2 border border-gray-300 rounded-lg w-full text-sm",disabled:t})]}),(0,i.jsxs)("button",{onClick:()=>{C({}),F(u,y,f,b,w,k)},disabled:t,className:"flex items-center px-4 py-2 text-sm rounded-lg transition duration-300 w-full md:w-auto justify-center ".concat(t?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-sky-600 text-white hover:bg-sky-700"),children:[(0,i.jsx)(n.KSO,{className:"mr-2 ".concat(t?"animate-pulse":"")}),t?"Fetching...":"Apply Filters"]})]}),(0,i.jsxs)("div",{className:"border-t border-gray-200 pt-4 flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4",children:[(0,i.jsx)(n.YsJ,{className:"text-gray-500 flex-shrink-0 hidden md:block",title:"Filters"}),(0,i.jsxs)("select",{value:k,onChange:e=>D(e.target.value),className:"p-2 border border-gray-300 rounded-lg w-full md:w-auto text-sm",disabled:t,children:[(0,i.jsx)("option",{value:"",children:"Filter by User Type"}),T.userTypes.map(e=>(0,i.jsx)("option",{value:e,children:e},e))]}),(0,i.jsxs)("select",{value:f,onChange:e=>{v(e.target.value),N("")},className:"p-2 border border-gray-300 rounded-lg w-full md:w-auto text-sm",disabled:t,children:[(0,i.jsx)("option",{value:"",children:"Filter by Country"}),T.countries.map(e=>(0,i.jsx)("option",{value:e,children:e},e))]}),(0,i.jsxs)("select",{value:b,onChange:e=>N(e.target.value),className:"p-2 border border-gray-300 rounded-lg w-full md:w-auto text-sm",disabled:t,children:[(0,i.jsx)("option",{value:"",children:"Filter by Region"}),T.regions.map(e=>(0,i.jsx)("option",{value:e,children:e},e))]}),(0,i.jsxs)("select",{value:w,onChange:e=>S(e.target.value),className:"p-2 border border-gray-300 rounded-lg w-full md:w-auto text-sm",disabled:t,children:[(0,i.jsx)("option",{value:"",children:"Filter by Device"}),T.devices.map(e=>(0,i.jsx)("option",{value:e,children:e},e))]})]})]}),(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-x-auto",children:[x&&(0,i.jsxs)("div",{className:"p-4 bg-red-100 text-red-700 border-l-4 border-red-500 flex items-center",children:[(0,i.jsx)(n.BS8,{className:"mr-3 flex-shrink-0 text-xl"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-semibold",children:x}),(0,i.jsx)("p",{className:"text-sm",children:'Please check the date range and ensure the scheduled job is running successfully to import new data. **If you still see "GA4 Restricted," you must manually run the MariaDB command above to clear the old records and restart the server.**'})]})]}),t&&0===e.length?(0,i.jsxs)("div",{className:"p-6 text-center text-gray-500",children:[(0,i.jsx)(n.Swo,{className:"mx-auto text-3xl mb-2 animate-spin"}),(0,i.jsx)("p",{children:"Loading historical report for selected dates..."})]}):(0,i.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,i.jsx)("thead",{className:"bg-gray-50",children:(0,i.jsx)("tr",{children:R.map(e=>(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:e.title},e.key))})}),(0,i.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.length>0?e.map((e,s)=>(0,i.jsxs)(r.Fragment,{children:[(0,i.jsx)("tr",{className:"hover:bg-sky-50/50",children:R.map(s=>(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:s.render(e)},s.key))}),A[e.id]&&(0,i.jsx)("tr",{className:"bg-gray-100/50",children:(0,i.jsxs)("td",{colSpan:R.length,className:"px-6 py-3 text-sm text-gray-700",children:[(0,i.jsx)("div",{className:"font-semibold mb-2",children:"Detailed Session Information (Drill-Down)"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"User Identifier (Client ID):"})," ",e.userIdentifier]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Raw Session ID:"})," ",e.rawSessionId]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"OS Version:"})," ",e.operatingSystem," ",e.osVersion]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Screen Resolution:"})," ",e.screenResolution]})]})]})})]},e.id||s)):!x&&(0,i.jsx)("tr",{children:(0,i.jsxs)("td",{colSpan:R.length,className:"px-6 py-12 text-center text-gray-500",children:[(0,i.jsx)(n.v$b,{className:"mx-auto text-4xl mb-4 text-gray-400"}),(0,i.jsx)("p",{className:"text-lg font-semibold",children:"No visitor data found for the selected date range."})]})})})]})]})]})}}}]);
//# sourceMappingURL=106.92537f91.chunk.js.map