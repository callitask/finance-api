# ===================================================================
# GLOBAL APPLICATION DEFAULTS
# These settings apply to ALL profiles (dev, prod, test).
# Profile-specific settings (Database, Secrets) are in application-{profile}.properties
# ===================================================================

spring.application.name=finance-api

# --- JSON SERIALIZATION (Standardized for all envs) ---
# Ensures consistent date formatting across Dev and Prod
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.date-format=yyyy-MM-dd'T'HH:mm:ss

# --- INFRASTRUCTURE TOGGLES ---
# Vault is explicitly disabled as per Phase 4.2 request to remove dependency on missing infra
spring.cloud.vault.enabled=false

# --- SECURITY DEFAULTS (Secure by Default) ---
# 1. Disable Swagger globally (Enable only in Dev)
# This acts as a safety net. If prod properties fail to load, Swagger remains off.
springdoc.api-docs.enabled=false
springdoc.swagger-ui.enabled=false

# 2. Default CORS (Safe Fallback)
# This is REQUIRED because SecurityConfig.java expects this key to exist.
# If a specific profile is loaded, its value will override this one.
cors.allowed-origins=http://localhost:3000

# --- ENTERPRISE DATABASE OPTIMIZATION (PHASE 1) ---
# Enables Batch Inserts/Updates to prevent N+1 performance issues
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# --- ENTERPRISE RESILIENCE (PHASE 2) ---
# Circuit Breaker: Python Script (Heavy I/O)
# Timeout: 120s (Scripts take time), Threshold: 50% failure rate
resilience4j.circuitbreaker.instances.pythonScript.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.pythonScript.slidingWindowSize=10
resilience4j.circuitbreaker.instances.pythonScript.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.pythonScript.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.instances.pythonScript.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.instances.pythonScript.waitDurationInOpenState=60s
resilience4j.circuitbreaker.instances.pythonScript.failureRateThreshold=50
resilience4j.circuitbreaker.instances.pythonScript.eventConsumerBufferSize=10
resilience4j.timelimiter.instances.pythonScript.timeoutDuration=120s

# Circuit Breaker: External APIs (FMP/AlphaVantage)
# Timeout: 5s (APIs should be fast)
resilience4j.circuitbreaker.instances.fmpApi.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.fmpApi.slidingWindowSize=20
resilience4j.circuitbreaker.instances.fmpApi.failureRateThreshold=50
resilience4j.circuitbreaker.instances.fmpApi.waitDurationInOpenState=30s
resilience4j.timelimiter.instances.fmpApi.timeoutDuration=5s

# --- REDIS CACHING DEFAULTS ---
# Default TTL: 10 Minutes (Prevents stale data from sticking forever)
spring.cache.redis.time-to-live=600000
spring.cache.redis.key-prefix=treishfin_