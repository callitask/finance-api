# ===================================================================
# TARGET: Production Configuration
# PHASE 17: Enterprise IAM (Keycloak) & Resilience
# ===================================================================

app.base-url=https://treishfin.treishvaamgroup.com
server.port=8080

# --- OBSERVABILITY ---
management.endpoints.web.exposure.include=health,info,prometheus
management.endpoint.health.show-details=always

# --- DISTRIBUTED TRACING ---
management.tracing.sampling.probability=0.1
management.zipkin.tracing.endpoint=http://treishvaam-tempo:9411/api/v2/spans

# --- LOGGING ---
logging.file.name=/app/logs/backend.json

# --- RABBITMQ MESSAGING ---
spring.rabbitmq.host=treishvaam-rabbitmq
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest
spring.rabbitmq.template.exchange=internal.exchange

# --- DATABASE ---
spring.datasource.url=${PROD_DB_URL}
spring.datasource.username=${PROD_DB_USERNAME}
spring.datasource.password=${PROD_DB_PASSWORD}
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver

# --- JPA ---
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MariaDBDialect
spring.jpa.show-sql=false

# --- REDIS ---
spring.cache.type=redis
spring.data.redis.host=treishvaam-redis
spring.data.redis.port=6379
spring.cache.redis.time-to-live=600000

# --- ELASTICSEARCH ---
spring.elasticsearch.uris=http://treishvaam-elastic:9200
spring.elasticsearch.socket-timeout=30s
spring.elasticsearch.connection-timeout=5s

# --- MINIO & STORAGE ---
# Used by MinioConfig.java
storage.s3.endpoint=http://treishvaam-minio:9000
storage.s3.region=us-east-1
storage.s3.access-key=admin
storage.s3.secret-key=treishvaam_storage_secret

# Used by FileStorageService.java (Must match @Value("${minio.bucket-name}"))
minio.bucket-name=treishvaam-uploads
# Kept for backward compatibility if needed
storage.s3.bucket=treishvaam-uploads

# Linux Path for Docker
storage.upload-dir=/app/uploads
storage.sitemap-dir=/app/sitemaps
app.python.script.path=/app/scripts/market_data_updater.py

# --- LIQUIBASE ---
spring.liquibase.change-log=classpath:db/changelog/db.changelog-master.xml

# --- SECURITY & KEYCLOAK (OAUTH2) ---
# Internal Secret for machine-to-machine communication (Cloudflare/Tunnel -> Backend)
app.security.internal-secret=${INTERNAL_API_SECRET_KEY}

# Keycloak Issuer URI (The Token Authority)
spring.security.oauth2.resourceserver.jwt.issuer-uri=${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI}
# JWK Set URI (To fetch Public Keys for Token Validation)
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWK_SET_URI}

# --- ADMIN ---
app.admin.email=${APP_ADMIN_EMAIL}
app.admin.password=${APP_ADMIN_PASSWORD}
app.admin.username=admin

# --- EXTERNAL APIS ---
fmp.api.key=${MARKET_DATA_API_KEY}
alphavantage.api.key=${ALPHAVANTAGE_API_KEY}
finnhub.api.key=${FINNHUB_API_KEY}
newsdata.api.key=${NEWS_API_KEY}

# --- GOOGLE ANALYTICS ---
ga4.property-id=${GA4_PROPERTY_ID}
ga4.credentials-path=/app/ga4-credentials.json