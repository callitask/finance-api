# ===================================================================
# TARGET: Production Configuration
# PHASE 18: Kubernetes Scalability & Vault Secrets
# ===================================================================

app.base-url=https://treishfin.treishvaamgroup.com
server.port=8080

# --- CONFIGURATION MANAGEMENT (VAULT) ---
spring.config.import=optional:vault://
spring.cloud.vault.uri=http://treishvaam-vault:8200
spring.cloud.vault.authentication=token
spring.cloud.vault.token=${VAULT_TOKEN}
spring.cloud.vault.scheme=http
spring.cloud.vault.fail-fast=false

# --- OBSERVABILITY ---
management.endpoints.web.exposure.include=health,info,prometheus
management.endpoint.health.show-details=always

# --- DISTRIBUTED TRACING ---
management.tracing.sampling.probability=0.1
management.zipkin.tracing.endpoint=http://treishvaam-tempo:9411/api/v2/spans

# --- LOGGING ---
logging.file.name=/app/logs/backend.json
logging.level.root=INFO
logging.level.com.treishvaam.finance=INFO

# --- RABBITMQ MESSAGING ---
spring.rabbitmq.host=treishvaam-rabbitmq
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest
spring.rabbitmq.template.exchange=internal.exchange

# --- DATABASE ---
spring.datasource.url=${PROD_DB_URL}
spring.datasource.username=${PROD_DB_USERNAME}
spring.datasource.password=${PROD_DB_PASSWORD}
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver

# --- JPA ---
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MariaDBDialect
spring.jpa.show-sql=false

# --- JSON SERIALIZATION ---
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.date-format=yyyy-MM-dd'T'HH:mm:ss

# --- CRITICAL FIX: FILE UPLOAD LIMITS ---
# Must match or exceed Nginx's 100MB limit
spring.servlet.multipart.max-file-size=100MB
spring.servlet.multipart.max-request-size=100MB
spring.servlet.multipart.enabled=true

# --- SECURITY & JWT ---
jwt.secret=${JWT_SECRET_KEY}
jwt.expiration.ms=86400000
app.security.internal-secret=${INTERNAL_API_SECRET_KEY}

# --- KEYCLOAK (OAUTH2) ---
spring.security.oauth2.resourceserver.jwt.issuer-uri=${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI}
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWK_SET_URI}

# --- CORS (Cross-Origin Resource Sharing) ---
# Explicitly set for Prod to prevent fallbacks
app.cors.allowed-origins=https://treishfin.treishvaamgroup.com
cors.allowed-origins=https://treishfin.treishvaamgroup.com

# --- REDIS ---
spring.cache.type=redis
spring.data.redis.host=treishvaam-redis
spring.data.redis.port=6379
spring.cache.redis.time-to-live=600000

# --- ELASTICSEARCH ---
spring.elasticsearch.uris=http://treishvaam-elastic:9200
spring.elasticsearch.socket-timeout=30s
spring.elasticsearch.connection-timeout=5s

# --- MINIO & STORAGE ---
storage.s3.endpoint=http://treishvaam-minio:9000
storage.s3.region=us-east-1
storage.s3.access-key=admin
storage.s3.secret-key=treishvaam_storage_secret
minio.bucket-name=treishvaam-uploads
storage.s3.bucket=treishvaam-uploads
storage.upload-dir=/app/uploads
storage.sitemap-dir=/app/sitemaps

# --- PYTHON SCRIPTS ---
app.python.script.path=/app/scripts/market_data_updater.py

# --- LIQUIBASE ---
spring.liquibase.change-log=classpath:db/changelog/db.changelog-master.xml

# --- ADMIN ---
app.admin.email=${APP_ADMIN_EMAIL}
app.admin.password=${APP_ADMIN_PASSWORD}
app.admin.username=admin

# --- EXTERNAL APIS ---
fmp.api.key=${MARKET_DATA_API_KEY}
alphavantage.api.key=${ALPHAVANTAGE_API_KEY}
finnhub.api.key=${FINNHUB_API_KEY}
newsdata.api.key=${NEWS_API_KEY}

# --- GOOGLE ANALYTICS ---
ga4.property-id=${GA4_PROPERTY_ID}
ga4.credentials-path=/app/ga4-credentials.json